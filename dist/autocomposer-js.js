(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports=ADSR;function ADSR(audioContext){var node=audioContext.createGain();var voltage=node._voltage=getVoltage(audioContext);var value=scale(voltage);var startValue=scale(voltage);var endValue=scale(voltage);node._startAmount=scale(startValue);node._endAmount=scale(endValue);node._multiplier=scale(value);node._multiplier.connect(node);node._startAmount.connect(node);node._endAmount.connect(node);node.value=value.gain;node.startValue=startValue.gain;node.endValue=endValue.gain;node.startValue.value=0;node.endValue.value=0;Object.defineProperties(node,props);return node}var props={attack:{value:0,writable:true},decay:{value:0,writable:true},sustain:{value:1,writable:true},release:{value:0,writable:true},getReleaseDuration:{value:function(){return this.release}},start:{value:function(at){var target=this._multiplier.gain;var startAmount=this._startAmount.gain;var endAmount=this._endAmount.gain;this._voltage.start(at);this._decayFrom=this._decayFrom=at+this.attack;this._startedAt=at;var sustain=this.sustain;target.cancelScheduledValues(at);startAmount.cancelScheduledValues(at);endAmount.cancelScheduledValues(at);endAmount.setValueAtTime(0,at);if(this.attack){target.setValueAtTime(0,at);target.linearRampToValueAtTime(1,at+this.attack);startAmount.setValueAtTime(1,at);startAmount.linearRampToValueAtTime(0,at+this.attack)}else{target.setValueAtTime(1,at);startAmount.setValueAtTime(0,at)}if(this.decay){target.setTargetAtTime(sustain,this._decayFrom,getTimeConstant(this.decay))}}},stop:{value:function(at,isTarget){if(isTarget){at=at-this.release}var endTime=at+this.release;if(this.release){var target=this._multiplier.gain;var startAmount=this._startAmount.gain;var endAmount=this._endAmount.gain;target.cancelScheduledValues(at);startAmount.cancelScheduledValues(at);endAmount.cancelScheduledValues(at);var expFalloff=getTimeConstant(this.release);if(this.attack&&at<this._decayFrom){var valueAtTime=getValue(0,1,this._startedAt,this._decayFrom,at);target.linearRampToValueAtTime(valueAtTime,at);startAmount.linearRampToValueAtTime(1-valueAtTime,at);startAmount.setTargetAtTime(0,at,expFalloff)}endAmount.setTargetAtTime(1,at,expFalloff);target.setTargetAtTime(0,at,expFalloff)}this._voltage.stop(endTime);return endTime}},onended:{get:function(){return this._voltage.onended},set:function(value){this._voltage.onended=value}}};var flat=new Float32Array([1,1]);function getVoltage(context){var voltage=context.createBufferSource();var buffer=context.createBuffer(1,2,context.sampleRate);buffer.getChannelData(0).set(flat);voltage.buffer=buffer;voltage.loop=true;return voltage}function scale(node){var gain=node.context.createGain();node.connect(gain);return gain}function getTimeConstant(time){return Math.log(time+1)/Math.log(100)}function getValue(start,end,fromTime,toTime,at){var difference=end-start;var time=toTime-fromTime;var truncateTime=at-fromTime;var phase=truncateTime/time;var value=start+phase*difference;if(value<=start){value=start}if(value>=end){value=end}return value}},{}],2:[function(require,module,exports){"use strict";function use(sep){return function(o,s){var l=arguments.length;return l===0?[]:Array.isArray(o)?o:typeof o==="string"?o.trim().split(l===1?sep:s):[o]}}var asArr=use(/\s+/);asArr.use=use;module.exports=asArr},{}],3:[function(require,module,exports){"use strict";function b64ToUint6(nChr){return nChr>64&&nChr<91?nChr-65:nChr>96&&nChr<123?nChr-71:nChr>47&&nChr<58?nChr+4:nChr===43?62:nChr===47?63:0}function decode(sBase64,nBlocksSize){var sB64Enc=sBase64.replace(/[^A-Za-z0-9\+\/]/g,"");var nInLen=sB64Enc.length;var nOutLen=nBlocksSize?Math.ceil((nInLen*3+1>>2)/nBlocksSize)*nBlocksSize:nInLen*3+1>>2;var taBytes=new Uint8Array(nOutLen);for(var nMod3,nMod4,nUint24=0,nOutIdx=0,nInIdx=0;nInIdx<nInLen;nInIdx++){nMod4=nInIdx&3;nUint24|=b64ToUint6(sB64Enc.charCodeAt(nInIdx))<<18-6*nMod4;if(nMod4===3||nInLen-nInIdx===1){for(nMod3=0;nMod3<3&&nOutIdx<nOutLen;nMod3++,nOutIdx++){taBytes[nOutIdx]=nUint24>>>(16>>>nMod3&24)&255}nUint24=0}}return taBytes}module.exports={decode:decode}},{}],4:[function(require,module,exports){"use strict";module.exports=function(url,type){return new Promise(function(done,reject){var req=new XMLHttpRequest;if(type)req.responseType=type;req.open("GET",url);req.onload=function(){req.status===200?done(req.response):reject(Error(req.statusText))};req.onerror=function(){reject(Error("Network Error"))};req.send()})}},{}],5:[function(require,module,exports){"use strict";var base64=require("./base64");var fetch=require("./fetch");function fromRegex(r){return function(o){return typeof o==="string"&&r.test(o)}}function prefix(pre,name){return typeof pre==="string"?pre+name:typeof pre==="function"?pre(name):name}function load(ac,source,options,defVal){var loader=isArrayBuffer(source)?loadArrayBuffer:isAudioFileName(source)?loadAudioFile:isPromise(source)?loadPromise:isArray(source)?loadArrayData:isObject(source)?loadObjectData:isJsonFileName(source)?loadJsonFile:isBase64Audio(source)?loadBase64Audio:isJsFileName(source)?loadMidiJSFile:null;var opts=options||{};return loader?loader(ac,source,opts):defVal?Promise.resolve(defVal):Promise.reject("Source not valid ("+source+")")}load.fetch=fetch;function isArrayBuffer(o){return o instanceof ArrayBuffer}function loadArrayBuffer(ac,array,options){return new Promise(function(done,reject){ac.decodeAudioData(array,function(buffer){done(buffer)},function(){reject("Can't decode audio data ("+array.slice(0,30)+"...)")})})}var isAudioFileName=fromRegex(/\.(mp3|wav|ogg)(\?.*)?$/i);function loadAudioFile(ac,name,options){var url=prefix(options.from,name);return load(ac,load.fetch(url,"arraybuffer"),options)}function isPromise(o){return o&&typeof o.then==="function"}function loadPromise(ac,promise,options){return promise.then(function(value){return load(ac,value,options)})}var isArray=Array.isArray;function loadArrayData(ac,array,options){return Promise.all(array.map(function(data){return load(ac,data,options,data)}))}function isObject(o){return o&&typeof o==="object"}function loadObjectData(ac,obj,options){var dest={};var promises=Object.keys(obj).map(function(key){if(options.only&&options.only.indexOf(key)===-1)return null;var value=obj[key];return load(ac,value,options,value).then(function(audio){dest[key]=audio})});return Promise.all(promises).then(function(){return dest})}var isJsonFileName=fromRegex(/\.json(\?.*)?$/i);function loadJsonFile(ac,name,options){var url=prefix(options.from,name);return load(ac,load.fetch(url,"text").then(JSON.parse),options)}var isBase64Audio=fromRegex(/^data:audio/);function loadBase64Audio(ac,source,options){var i=source.indexOf(",");return load(ac,base64.decode(source.slice(i+1)).buffer,options)}var isJsFileName=fromRegex(/\.js(\?.*)?$/i);function loadMidiJSFile(ac,name,options){var url=prefix(options.from,name);return load(ac,load.fetch(url,"text").then(midiJsToJson),options)}function midiJsToJson(data){var begin=data.indexOf("MIDI.Soundfont.");if(begin<0)throw Error("Invalid MIDI.js Soundfont format");begin=data.indexOf("=",begin)+2;var end=data.lastIndexOf(",");return JSON.parse(data.slice(begin,end)+"}")}if(typeof module==="object"&&module.exports)module.exports=load;if(typeof window!=="undefined")window.loadAudio=load},{"./base64":3,"./fetch":4}],6:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],7:[function(require,module,exports){},{}],8:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(value instanceof ArrayBuffer){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(isArrayBufferView(obj)||"length"in obj){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(isArrayBufferView(string)||string instanceof ArrayBuffer){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){
this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding);var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isArrayBufferView(obj){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}},{"base64-js":6,ieee754:9}],9:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],10:[function(require,module,exports){"use strict";var IVL_TNL="([-+]?)(\\d+)(d{1,4}|m|M|P|A{1,4})";var IVL_STR="(AA|A|P|M|m|d|dd)([-+]?)(\\d+)";var COMPOSE="(?:("+IVL_TNL+")|("+IVL_STR+"))";var IVL_REGEX=new RegExp("^"+COMPOSE+"$");function parse(str,strict){if(typeof str!=="string")return null;var m=IVL_REGEX.exec(str);if(!m)return null;var i={num:+(m[3]||m[8]),q:m[4]||m[6]};i.dir=(m[2]||m[7])==="-"?-1:1;var step=(i.num-1)%7;i.simple=step+1;i.type=TYPES[step];i.alt=qToAlt(i.type,i.q);i.oct=Math.floor((i.num-1)/7);i.size=i.dir*(SIZES[step]+i.alt+12*i.oct);if(strict!==false){if(i.type==="M"&&i.q==="P")return null}return i}var SIZES=[0,2,4,5,7,9,11];var TYPES="PMMPPMM";function type(num){return TYPES[(num-1)%7]}function dirStr(dir){return dir===-1?"-":""}function num(simple,oct){return simple+7*oct}function shorthand(simple,alt,oct,dir){return altToQ(simple,alt)+dirStr(dir)+num(simple,oct)}function build(simple,alt,oct,dir){return dirStr(dir)+num(simple,oct)+altToQ(simple,alt)}function qToAlt(num,q){var t=typeof num==="number"?type(num):num;if(q==="M"&&t==="M")return 0;if(q==="P"&&t==="P")return 0;if(q==="m"&&t==="M")return-1;if(/^A+$/.test(q))return q.length;if(/^d+$/.test(q))return t==="P"?-q.length:-q.length-1;return null}function fillStr(s,n){return Array(Math.abs(n)+1).join(s)}function altToQ(num,alt){var t=typeof num==="number"?type(Math.abs(num)):num;if(alt===0)return t==="M"?"M":"P";else if(alt===-1&&t==="M")return"m";else if(alt>0)return fillStr("A",alt);else if(alt<0)return fillStr("d",t==="P"?alt:alt+1);else return null}module.exports={parse:parse,type:type,altToQ:altToQ,qToAlt:qToAlt,build:build,shorthand:shorthand}},{}],11:[function(require,module,exports){(function(Buffer){"use strict";var Constants={VERSION:"1.1.0",NOTES:[]};(function(){var allNotes=[["C"],["C#","Db"],["D"],["D#","Eb"],["E"],["F"],["F#","Gb"],["G"],["G#","Ab"],["A"],["A#","Bb"],["B"]];var counter=0;var _loop=function _loop(i){allNotes.forEach(function(noteGroup){noteGroup.forEach(function(note){return Constants.NOTES[counter]=note+i});counter++})};for(var i=-1;i<=9;i++){_loop(i)}})();exports.Constants=Constants;"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Player=function(){function Player(eventHandler,buffer){_classCallCheck(this,Player);this.sampleRate=5;this.startTime=0;this.buffer=buffer||null;this.division;this.format;this.setIntervalId=null;this.tracks=[];this.tempo=120;this.startTick=0;this.tick=0;this.lastTick=null;this.inLoop=false;this.totalTicks=0;this.events=[];this.eventListeners={};if(typeof eventHandler==="function")this.on("midiEvent",eventHandler)}_createClass(Player,[{key:"loadFile",value:function loadFile(path){var fs=require("fs");this.buffer=fs.readFileSync(path);return this.fileLoaded()}},{key:"loadArrayBuffer",value:function loadArrayBuffer(arrayBuffer){this.buffer=new Uint8Array(arrayBuffer);return this.fileLoaded()}},{key:"loadDataUri",value:function loadDataUri(dataUri){var byteString=Utils.atob(dataUri.split(",")[1]);var ia=new Uint8Array(byteString.length);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}this.buffer=ia;return this.fileLoaded()}},{key:"getFilesize",value:function getFilesize(){return this.buffer?this.buffer.length:0}},{key:"fileLoaded",value:function fileLoaded(){if(!this.validate())throw"Invalid MIDI file; should start with MThd";return this.getDivision().getFormat().getTracks().dryRun()}},{key:"validate",value:function validate(){return Utils.bytesToLetters(this.buffer.slice(0,4))==="MThd"}},{key:"getFormat",value:function getFormat(){this.format=Utils.bytesToNumber(this.buffer.slice(8,10));return this}},{key:"getTracks",value:function getTracks(){this.tracks=[];this.buffer.forEach(function(byte,index){if(Utils.bytesToLetters(this.buffer.slice(index,index+4))=="MTrk"){var trackLength=Utils.bytesToNumber(this.buffer.slice(index+4,index+8));this.tracks.push(new Track(this.tracks.length,this.buffer.slice(index+8,index+8+trackLength)))}},this);return this}},{key:"enableTrack",value:function enableTrack(trackNumber){this.tracks[trackNumber-1].enable();return this}},{key:"disableTrack",value:function disableTrack(trackNumber){this.tracks[trackNumber-1].disable();return this}},{key:"getDivision",value:function getDivision(){this.division=Utils.bytesToNumber(this.buffer.slice(12,14));return this}},{key:"playLoop",value:function playLoop(dryRun){if(!this.inLoop){this.inLoop=true;this.tick=this.getCurrentTick();this.tracks.forEach(function(track){if(!dryRun&&this.endOfFile()){this.triggerPlayerEvent("endOfFile");this.stop()}else{var event=track.handleEvent(this.tick,dryRun);if(event&&!dryRun)this.emitEvent(event)}},this);if(!dryRun)this.triggerPlayerEvent("playing",{tick:this.tick});this.inLoop=false}}},{key:"setStartTime",value:function setStartTime(startTime){this.startTime=startTime}},{key:"play",value:function play(){if(this.isPlaying())throw"Already playing...";if(!this.startTime)this.startTime=(new Date).getTime();this.setIntervalId=setInterval(this.playLoop.bind(this),this.sampleRate);return this}},{key:"pause",value:function pause(){clearInterval(this.setIntervalId);this.setIntervalId=false;this.startTick=this.tick;this.startTime=0;return this}},{key:"stop",value:function stop(){clearInterval(this.setIntervalId);this.setIntervalId=false;this.startTick=0;this.startTime=0;this.resetTracks();return this}},{key:"isPlaying",value:function isPlaying(){return this.setIntervalId>0}},{key:"dryRun",value:function dryRun(){this.resetTracks();while(!this.endOfFile()){this.playLoop(true)}this.events=this.getEvents();this.totalTicks=this.getTotalTicks();this.startTick=0;this.startTime=0;this.resetTracks();this.triggerPlayerEvent("fileLoaded",this);return this}},{key:"resetTracks",value:function resetTracks(){this.tracks.forEach(function(track){return track.reset()});return this}},{key:"getEvents",value:function getEvents(){return this.tracks.map(function(track){return track.events})}},{key:"getTotalTicks",value:function getTotalTicks(){return Math.max.apply(null,this.tracks.map(function(track){return track.delta}))}},{key:"getSongTime",value:function getSongTime(){return this.totalTicks/this.division/this.tempo*60}},{key:"getSongTimeRemaining",value:function getSongTimeRemaining(){return Math.round((this.totalTicks-this.tick)/this.division/this.tempo*60)}},{key:"getSongPercentRemaining",value:function getSongPercentRemaining(){return Math.round(this.getSongTimeRemaining()/this.getSongTime()*100)}},{key:"bytesProcessed",value:function bytesProcessed(){return 14+this.tracks.length*8+this.tracks.reduce(function(a,b){return{pointer:a.pointer+b.pointer}},{pointer:0}).pointer}},{key:"endOfFile",value:function endOfFile(){return this.bytesProcessed()==this.buffer.length}},{key:"getCurrentTick",value:function getCurrentTick(){return Math.round(((new Date).getTime()-this.startTime)/1e3*(this.division*(this.tempo/60)))+this.startTick}},{key:"emitEvent",value:function emitEvent(event){if(event.hasOwnProperty("name")&&event.name==="Set Tempo")this.tempo=event.data;this.triggerPlayerEvent("midiEvent",event);return this}},{key:"on",value:function on(playerEvent,fn){if(!this.eventListeners.hasOwnProperty(playerEvent))this.eventListeners[playerEvent]=[];this.eventListeners[playerEvent].push(fn);return this}},{key:"triggerPlayerEvent",value:function triggerPlayerEvent(playerEvent,data){if(this.eventListeners.hasOwnProperty(playerEvent))this.eventListeners[playerEvent].forEach(function(fn){return fn(data||{})});return this}}]);return Player}();exports.Player=Player;"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Track=function(){function Track(index,data){_classCallCheck(this,Track);this.enabled=true;this.pointer=0;this.lastTick=0;this.lastStatus=null;this.index=index;this.data=data;this.delta=0;this.runningDelta=0;this.events=[]}_createClass(Track,[{key:"reset",value:function reset(){this.enabled=true;this.pointer=0;this.lastTick=0;this.lastStatus=null;this.delta=0;this.runningDelta=0;return this}},{key:"enable",value:function enable(){this.enabled=true;return this}},{key:"disable",value:function disable(){this.enabled=false;return this}},{key:"getCurrentByte",value:function getCurrentByte(){return this.data[this.pointer]}},{key:"getDeltaByteCount",value:function getDeltaByteCount(){var currentByte=this.getCurrentByte();var byteCount=1;while(currentByte>=128){currentByte=this.data[this.pointer+byteCount];byteCount++}return byteCount}},{key:"getDelta",value:function getDelta(){return Utils.readVarInt(this.data.slice(this.pointer,this.pointer+this.getDeltaByteCount()))}},{key:"handleEvent",value:function handleEvent(currentTick,dryRun){dryRun=dryRun||false;if(this.pointer<this.data.length&&(dryRun||currentTick-this.lastTick>=this.getDelta())){var _event=this.parseEvent();if(this.enabled)return _event}return null}},{key:"getStringData",value:function getStringData(eventStartIndex){var currentByte=this.pointer;var byteCount=1;var length=Utils.readVarInt(this.data.slice(eventStartIndex+2,eventStartIndex+2+byteCount));var stringLength=length;return Utils.bytesToLetters(this.data.slice(eventStartIndex+byteCount+2,eventStartIndex+byteCount+length+2))}},{key:"parseEvent",value:function parseEvent(){var eventStartIndex=this.pointer+this.getDeltaByteCount();var eventJson={};var deltaByteCount=this.getDeltaByteCount();eventJson.track=this.index+1;eventJson.delta=this.getDelta();this.lastTick=this.lastTick+eventJson.delta;this.runningDelta+=eventJson.delta;eventJson.tick=this.runningDelta;if(this.data[eventStartIndex]==255){switch(this.data[eventStartIndex+1]){case 0:eventJson.name="Sequence Number";break;case 1:eventJson.name="Text Event";eventJson.string=this.getStringData(eventStartIndex);break;case 2:eventJson.name="Copyright Notice";break;case 3:eventJson.name="Sequence/Track Name";eventJson.string=this.getStringData(eventStartIndex);break;case 4:eventJson.name="Instrument Name";eventJson.string=this.getStringData(eventStartIndex);break;case 5:eventJson.name="Lyric";eventJson.string=this.getStringData(eventStartIndex);break;case 6:eventJson.name="Marker";break;case 7:eventJson.name="Cue Point";eventJson.string=this.getStringData(eventStartIndex);break;case 9:eventJson.name="Device Name";eventJson.string=this.getStringData(eventStartIndex);break;case 32:eventJson.name="MIDI Channel Prefix";break;case 33:eventJson.name="MIDI Port";eventJson.data=Utils.bytesToNumber([this.data[eventStartIndex+3]]);break;case 47:eventJson.name="End of Track";break;case 81:eventJson.name="Set Tempo";eventJson.data=Math.round(6e7/Utils.bytesToNumber(this.data.slice(eventStartIndex+3,eventStartIndex+6)));this.tempo=eventJson.data;break;case 84:eventJson.name="SMTPE Offset";break;case 88:eventJson.name="Time Signature";break;case 89:eventJson.name="Key Signature";break;case 127:eventJson.name="Sequencer-Specific Meta-event";break;default:eventJson.name="Unknown: "+this.data[eventStartIndex+1].toString(16);break}var length=this.data[this.pointer+deltaByteCount+2];this.pointer+=deltaByteCount+3+length}else if(this.data[eventStartIndex]==240){eventJson.name="Sysex";var length=this.data[this.pointer+deltaByteCount+1];this.pointer+=deltaByteCount+2+length}else{if(this.data[eventStartIndex]<128){eventJson.running=true;eventJson.noteNumber=this.data[eventStartIndex];eventJson.noteName=Constants.NOTES[this.data[eventStartIndex]];eventJson.velocity=this.data[eventStartIndex+1];if(this.lastStatus<=143){eventJson.name="Note off";eventJson.channel=this.lastStatus-128+1}else if(this.lastStatus<=159){eventJson.name="Note on";eventJson.channel=this.lastStatus-144+1}this.pointer+=deltaByteCount+2}else{this.lastStatus=this.data[eventStartIndex];if(this.data[eventStartIndex]<=143){eventJson.name="Note off";eventJson.channel=this.lastStatus-128+1;eventJson.noteNumber=this.data[eventStartIndex+1];eventJson.noteName=Constants.NOTES[this.data[eventStartIndex+1]];eventJson.velocity=Math.round(this.data[eventStartIndex+2]/127*100);this.pointer+=deltaByteCount+3}else if(this.data[eventStartIndex]<=159){eventJson.name="Note on";eventJson.channel=this.lastStatus-144+1;eventJson.noteNumber=this.data[eventStartIndex+1];eventJson.noteName=Constants.NOTES[this.data[eventStartIndex+1]];eventJson.velocity=Math.round(this.data[eventStartIndex+2]/127*100);this.pointer+=deltaByteCount+3}else if(this.data[eventStartIndex]<=175){eventJson.name="Polyphonic Key Pressure";eventJson.channel=this.lastStatus-160+1;eventJson.note=Constants.NOTES[this.data[eventStartIndex+1]];eventJson.pressure=event[2];this.pointer+=deltaByteCount+3}else if(this.data[eventStartIndex]<=191){eventJson.name="Controller Change";eventJson.channel=this.lastStatus-176+1;eventJson.number=this.data[eventStartIndex+1];eventJson.value=this.data[eventStartIndex+2];this.pointer+=deltaByteCount+3}else if(this.data[eventStartIndex]<=207){eventJson.name="Program Change";eventJson.channel=this.lastStatus-192+1;this.pointer+=deltaByteCount+2}else if(this.data[eventStartIndex]<=223){eventJson.name="Channel Key Pressure";eventJson.channel=this.lastStatus-208+1;this.pointer+=deltaByteCount+2}else if(this.data[eventStartIndex]<=239){eventJson.name="Pitch Bend";eventJson.channel=this.lastStatus-224+1;this.pointer+=deltaByteCount+3}else{eventJson.name="Unknown.  Pointer: "+this.pointer.toString()+" "+eventStartIndex.toString()+" "+this.data.length}}}this.delta+=eventJson.delta;this.events.push(eventJson);return eventJson}},{key:"endOfTrack",value:function endOfTrack(){if(this.data[this.pointer+1]==255&&this.data[this.pointer+2]==47&&this.data[this.pointer+3]==0){return true}return false}}]);return Track}();"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Utils=function(){function Utils(){_classCallCheck(this,Utils)}_createClass(Utils,null,[{key:"byteToHex",value:function byteToHex(byte){return("0"+byte.toString(16)).slice(-2)}},{key:"bytesToHex",value:function bytesToHex(byteArray){var hex=[];byteArray.forEach(function(byte){return hex.push(Utils.byteToHex(byte))});return hex.join("")}},{key:"hexToNumber",value:function hexToNumber(hexString){return parseInt(hexString,16)}},{key:"bytesToNumber",value:function bytesToNumber(byteArray){return Utils.hexToNumber(Utils.bytesToHex(byteArray))}},{key:"bytesToLetters",value:function bytesToLetters(byteArray){var letters=[];byteArray.forEach(function(byte){return letters.push(String.fromCharCode(byte))});return letters.join("")}},{key:"decToBinary",value:function decToBinary(dec){return(dec>>>0).toString(2)}},{key:"readVarInt",value:function readVarInt(byteArray){var result=0;byteArray.forEach(function(number){var b=number;if(b&128){result+=b&127;result<<=7}else{result+=b}});return result}},{key:"atob",value:function(_atob){function atob(_x){return _atob.apply(this,arguments)}atob.toString=function(){return _atob.toString()};return atob}(function(string){if(typeof atob==="function")return atob(string);return new Buffer(string,"base64").toString("binary")})}]);return Utils}();exports.Utils=Utils}).call(this,require("buffer").Buffer)},{buffer:8,fs:7}],12:[function(require,module,exports){(function(process,Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Chunk=function Chunk(fields){_classCallCheck(this,Chunk);this.type=fields.type;this.data=fields.data;this.size=[0,0,0,fields.data.length]};exports.Chunk=Chunk;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Constants={VERSION:"1.4.7",HEADER_CHUNK_TYPE:[77,84,104,100],HEADER_CHUNK_LENGTH:[0,0,0,6],HEADER_CHUNK_FORMAT0:[0,0],HEADER_CHUNK_FORMAT1:[0,1],HEADER_CHUNK_DIVISION:[0,128],TRACK_CHUNK_TYPE:[77,84,114,107],META_EVENT_ID:255,META_TEXT_ID:1,META_COPYRIGHT_ID:2,META_TRACK_NAME_ID:3,META_INSTRUMENT_NAME_ID:4,META_LYRIC_ID:5,META_MARKER_ID:6,META_CUE_POINT:7,META_TEMPO_ID:81,META_SMTPE_OFFSET:84,META_TIME_SIGNATURE_ID:88,META_KEY_SIGNATURE_ID:89,META_END_OF_TRACK_ID:[47,0],PROGRAM_CHANGE_STATUS:192};exports.Constants=Constants;"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MetaEvent=function MetaEvent(fields){_classCallCheck(this,MetaEvent);this.type="meta";this.data=Utils.numberToVariableLength(0);this.data=this.data.concat(Constants.META_EVENT_ID,fields.data)};exports.MetaEvent=MetaEvent;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var NoteEvent=function(){function NoteEvent(fields){_classCallCheck(this,NoteEvent);this.type="note";this.pitch=fields.pitch;this.wait=fields.wait||0;this.duration=fields.duration;this.sequential=fields.sequential||false;this.velocity=fields.velocity||50;this.channel=fields.channel||1;this.repeat=fields.repeat||1;this.velocity=this.convertVelocity(this.velocity);this.buildData()}_createClass(NoteEvent,[{key:"buildData",value:function buildData(){this.data=[];var tickDuration=this.getTickDuration(this.duration,"note");var restDuration=this.getTickDuration(this.wait,"rest");var noteOn,noteOff;if(Array.isArray(this.pitch)){if(!this.sequential){for(var j=0;j<this.repeat;j++){this.pitch.forEach(function(p,i){if(i==0){noteOn=new NoteOnEvent({data:Utils.numberToVariableLength(restDuration).concat(this.getNoteOnStatus(),Utils.getPitch(p),this.velocity)})}else{noteOn=new NoteOnEvent({data:[0,Utils.getPitch(p),this.velocity]})}this.data=this.data.concat(noteOn.data)},this);this.pitch.forEach(function(p,i){if(i==0){noteOff=new NoteOffEvent({data:Utils.numberToVariableLength(tickDuration).concat(this.getNoteOffStatus(),Utils.getPitch(p),this.velocity)})}else{noteOff=new NoteOffEvent({data:[0,Utils.getPitch(p),this.velocity]})}this.data=this.data.concat(noteOff.data)},this)}}else{for(var j=0;j<this.repeat;j++){this.pitch.forEach(function(p,i){if(i>0){restDuration=0}if(this.duration==="8t"&&i==this.pitch.length-1){var quarterTicks=Utils.numberFromBytes(Constants.HEADER_CHUNK_DIVISION);tickDuration=quarterTicks-tickDuration*2}noteOn=new NoteOnEvent({data:Utils.numberToVariableLength(restDuration).concat([this.getNoteOnStatus(),Utils.getPitch(p),this.velocity])});noteOff=new NoteOffEvent({data:Utils.numberToVariableLength(tickDuration).concat([this.getNoteOffStatus(),Utils.getPitch(p),this.velocity])});this.data=this.data.concat(noteOn.data,noteOff.data)},this)}}return this}throw"pitch must be an array."}},{key:"convertVelocity",value:function convertVelocity(velocity){velocity=velocity>100?100:velocity;return Math.round(velocity/100*127)}},{key:"getTickDuration",value:function getTickDuration(duration,type){if(Array.isArray(duration)){return duration.map(function(value){return this.getTickDuration(value,type)},this).reduce(function(a,b){return a+b},0)}duration=duration.toString();if(duration.toLowerCase().charAt(0)==="t"){return parseInt(duration.substring(1))}var quarterTicks=Utils.numberFromBytes(Constants.HEADER_CHUNK_DIVISION);return Math.round(quarterTicks*this.getDurationMultiplier(duration,type))}},{key:"getDurationMultiplier",value:function getDurationMultiplier(duration,type){switch(duration){case"0":return 0;case"1":return 4;case"2":return 2;case"d2":return 3;case"4":return 1;case"d4":return 1.5;case"8":return.5;case"8t":return.33;case"d8":return.75;case"16":return.25;default:}throw duration+" is not a valid duration."}},{key:"getNoteOnStatus",value:function getNoteOnStatus(){return 144+this.channel-1}},{key:"getNoteOffStatus",
value:function getNoteOffStatus(){return 128+this.channel-1}}]);return NoteEvent}();exports.NoteEvent=NoteEvent;"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var NoteOffEvent=function NoteOffEvent(fields){_classCallCheck(this,NoteOffEvent);this.data=fields.data};exports.NoteOffEvent=NoteOffEvent;"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var NoteOnEvent=function NoteOnEvent(fields){_classCallCheck(this,NoteOnEvent);this.data=fields.data};exports.NoteOnEvent=NoteOnEvent;"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ProgramChangeEvent=function ProgramChangeEvent(fields){_classCallCheck(this,ProgramChangeEvent);this.type="program";this.data=Utils.numberToVariableLength(0).concat(Constants.PROGRAM_CHANGE_STATUS,fields.instrument)};exports.ProgramChangeEvent=ProgramChangeEvent;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Track=function(){function Track(){_classCallCheck(this,Track);this.type=Constants.TRACK_CHUNK_TYPE;this.data=[];this.size=[];this.events=[]}_createClass(Track,[{key:"addEvent",value:function addEvent(event,mapFunction){if(Array.isArray(event)){event.forEach(function(e,i){if(typeof mapFunction==="function"&&e.type==="note"){var properties=mapFunction(i,e);if((typeof properties==="undefined"?"undefined":_typeof(properties))==="object"){for(var j in properties){switch(j){case"duration":e.duration=properties[j];break;case"sequential":e.sequential=properties[j];break;case"velocity":e.velocity=e.convertVelocity(properties[j]);break}}e.buildData()}}this.data=this.data.concat(e.data);this.size=Utils.numberToBytes(this.data.length,4);this.events.push(e)},this)}else{this.data=this.data.concat(event.data);this.size=Utils.numberToBytes(this.data.length,4);this.events.push(event)}return this}},{key:"setTempo",value:function setTempo(bpm){var event=new MetaEvent({data:[Constants.META_TEMPO_ID]});event.data.push(3);var tempo=Math.round(6e7/bpm);event.data=event.data.concat(Utils.numberToBytes(tempo,3));return this.addEvent(event)}},{key:"setTimeSignature",value:function setTimeSignature(numerator,denominator,midiclockspertick,notespermidiclock){midiclockspertick=midiclockspertick||24;notespermidiclock=notespermidiclock||8;var event=new MetaEvent({data:[Constants.META_TIME_SIGNATURE_ID]});event.data.push(4);event.data=event.data.concat(Utils.numberToBytes(numerator,1));var _denominator=Math.log2(denominator);event.data=event.data.concat(Utils.numberToBytes(_denominator,1));event.data=event.data.concat(Utils.numberToBytes(midiclockspertick,1));event.data=event.data.concat(Utils.numberToBytes(notespermidiclock,1));return this.addEvent(event)}},{key:"setKeySignature",value:function setKeySignature(sf,mi){var event=new MetaEvent({data:[Constants.META_KEY_SIGNATURE_ID]});event.data.push(2);var mode=mi||0;sf=sf||0;if(typeof mi==="undefined"){var fifths=[["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"],["ab","eb","bb","f","c","g","d","a","e","b","f#","c#","g#","d#","a#"]];var _sflen=sf.length;var note=sf||"C";if(sf[0]===sf[0].toLowerCase())mode=1;if(_sflen>1){switch(sf.charAt(_sflen-1)){case"m":mode=1;note=sf.charAt(0).toLowerCase();note=note.concat(sf.substring(1,_sflen-1));break;case"-":mode=1;note=sf.charAt(0).toLowerCase();note=note.concat(sf.substring(1,_sflen-1));break;case"M":mode=0;note=sf.charAt(0).toUpperCase();note=note.concat(sf.substring(1,_sflen-1));break;case"+":mode=0;note=sf.charAt(0).toUpperCase();note=note.concat(sf.substring(1,_sflen-1));break}}var fifthindex=fifths[mode].indexOf(note);sf=fifthindex===-1?0:fifthindex-7}event.data=event.data.concat(Utils.numberToBytes(sf,1));event.data=event.data.concat(Utils.numberToBytes(mode,1));return this.addEvent(event)}},{key:"addText",value:function addText(text){var event=new MetaEvent({data:[Constants.META_TEXT_ID]});var stringBytes=Utils.stringToBytes(text);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"addCopyright",value:function addCopyright(text){var event=new MetaEvent({data:[Constants.META_COPYRIGHT_ID]});var stringBytes=Utils.stringToBytes(text);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"addTrackName",value:function addTrackName(text){var event=new MetaEvent({data:[Constants.META_TRACK_NAME_ID]});var stringBytes=Utils.stringToBytes(text);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"addInstrumentName",value:function addInstrumentName(text){var event=new MetaEvent({data:[Constants.META_INSTRUMENT_NAME_ID]});var stringBytes=Utils.stringToBytes(text);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"addMarker",value:function addMarker(text){var event=new MetaEvent({data:[Constants.META_MARKER_ID]});var stringBytes=Utils.stringToBytes(text);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"addCuePoint",value:function addCuePoint(text){var event=new MetaEvent({data:[Constants.META_CUE_POINT]});var stringBytes=Utils.stringToBytes(text);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"addLyric",value:function addLyric(lyric){var event=new MetaEvent({data:[Constants.META_LYRIC_ID]});var stringBytes=Utils.stringToBytes(lyric);event.data=event.data.concat(Utils.numberToVariableLength(stringBytes.length));event.data=event.data.concat(stringBytes);return this.addEvent(event)}},{key:"polyModeOn",value:function polyModeOn(){var event=new NoteOnEvent({data:[0,176,126,0]});return this.addEvent(event)}}]);return Track}();exports.Track=Track;"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Utils=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _tonalMidi=require("tonal-midi");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Utils=function(){function Utils(){_classCallCheck(this,Utils)}_createClass(Utils,null,[{key:"version",value:function version(){return Constants.VERSION}},{key:"stringToBytes",value:function stringToBytes(string){return string.split("").map(function(char){return char.charCodeAt()})}},{key:"isNumeric",value:function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}},{key:"getPitch",value:function getPitch(pitch){return(0,_tonalMidi.toMidi)(pitch)}},{key:"numberToVariableLength",value:function numberToVariableLength(ticks){var buffer=ticks&127;while(ticks=ticks>>7){buffer<<=8;buffer|=ticks&127|128}var bList=[];while(true){bList.push(buffer&255);if(buffer&128)buffer>>=8;else{break}}return bList}},{key:"stringByteCount",value:function stringByteCount(s){return encodeURI(s).split(/%..|./).length-1}},{key:"numberFromBytes",value:function numberFromBytes(bytes){var hex="";var stringResult;bytes.forEach(function(byte){stringResult=byte.toString(16);if(stringResult.length==1)stringResult="0"+stringResult;hex+=stringResult});return parseInt(hex,16)}},{key:"numberToBytes",value:function numberToBytes(number,bytesNeeded){bytesNeeded=bytesNeeded||1;var hexString=number.toString(16);if(hexString.length&1){hexString="0"+hexString}var hexArray=hexString.match(/.{2}/g);hexArray=hexArray.map(function(item){return parseInt(item,16)});if(hexArray.length<bytesNeeded){while(bytesNeeded-hexArray.length>0){hexArray.unshift(0)}}return hexArray}}]);return Utils}();exports.Utils=Utils;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var VexFlow=function(){function VexFlow(){_classCallCheck(this,VexFlow)}_createClass(VexFlow,[{key:"trackFromVoice",value:function trackFromVoice(voice){var track=new Track;var wait;var pitches=[];voice.tickables.forEach(function(tickable,i){pitches=[];if(tickable.noteType==="n"){notes[i].keys.forEach(function(key){pitches.push(this.convertPitch(key))})}else if(tickable.noteType==="r"){wait=this.convertDuration(tickable);return}track.addEvent(new NoteEvent({pitch:pitches,duration:this.convertDuration(voice.tickables[i]),wait:wait}));wait=0});return track}},{key:"convertPitch",value:function convertPitch(pitch){return pitch.replace("/","")}},{key:"convertDuration",value:function convertDuration(note){switch(note.duration){case"w":return"1";case"h":return note.isDotted()?"d2":"2";case"q":return note.isDotted()?"d4":"4";case"8":return note.isDotted()?"d8":"8"}return note.duration}}]);return VexFlow}();exports.VexFlow=VexFlow;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Writer=function(){function Writer(tracks){_classCallCheck(this,Writer);this.data=[];var trackType=tracks.length>1?Constants.HEADER_CHUNK_FORMAT1:Constants.HEADER_CHUNK_FORMAT0;var numberOfTracks=Utils.numberToBytes(tracks.length,2);this.data.push(new Chunk({type:Constants.HEADER_CHUNK_TYPE,data:trackType.concat(numberOfTracks,Constants.HEADER_CHUNK_DIVISION)}));tracks.forEach(function(track,i){track.addEvent(new MetaEvent({data:Constants.META_END_OF_TRACK_ID}));this.data.push(track)},this)}_createClass(Writer,[{key:"buildFile",value:function buildFile(){var build=[];this.data.forEach(function(d){return build=build.concat(d.type,d.size,d.data)});return new Uint8Array(build)}},{key:"base64",value:function base64(){if(typeof btoa==="function")return btoa(String.fromCharCode.apply(null,this.buildFile()));return new Buffer(this.buildFile()).toString("base64")}},{key:"dataUri",value:function dataUri(){return"data:audio/midi;base64,"+this.base64()}},{key:"stdout",value:function stdout(){return process.stdout.write(new Buffer(this.buildFile()))}},{key:"saveMIDI",value:function saveMIDI(filename){var buffer=new Buffer(this.buildFile());fs.writeFile(filename+".mid",buffer,function(err){if(err)return console.log(err)})}}]);return Writer}();exports.Writer=Writer}).call(this,require("_process"),require("buffer").Buffer)},{_process:15,buffer:8,"tonal-midi":35}],13:[function(require,module,exports){(function(global){(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.midimessage=e()}})(function(){var e,t,s;return function o(e,t,s){function a(n,i){if(!t[n]){if(!e[n]){var l=typeof require=="function"&&require;if(!i&&l)return l(n,!0);if(r)return r(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var c=t[n]={exports:{}};e[n][0].call(c.exports,function(t){var s=e[n][1][t];return a(s?s:t)},c,c.exports,o,e,t,s)}return t[n].exports}var r=typeof require=="function"&&require;for(var n=0;n<s.length;n++)a(s[n]);return a}({1:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:true});s["default"]=function(e){function t(e){this._event=e;this._data=e.data;this.receivedTime=e.receivedTime;if(this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}this._messageCode=e.data[0]&240;this.channel=e.data[0]&15;switch(this._messageCode){case 128:this.messageType="noteoff";this.key=e.data[1]&127;this.velocity=e.data[2]&127;break;case 144:this.messageType="noteon";this.key=e.data[1]&127;this.velocity=e.data[2]&127;break;case 160:this.messageType="keypressure";this.key=e.data[1]&127;this.pressure=e.data[2]&127;break;case 176:this.messageType="controlchange";this.controllerNumber=e.data[1]&127;this.controllerValue=e.data[2]&127;if(this.controllerNumber===120&&this.controllerValue===0){this.channelModeMessage="allsoundoff"}else if(this.controllerNumber===121){this.channelModeMessage="resetallcontrollers"}else if(this.controllerNumber===122){if(this.controllerValue===0){this.channelModeMessage="localcontroloff"}else{this.channelModeMessage="localcontrolon"}}else if(this.controllerNumber===123&&this.controllerValue===0){this.channelModeMessage="allnotesoff"}else if(this.controllerNumber===124&&this.controllerValue===0){this.channelModeMessage="omnimodeoff"}else if(this.controllerNumber===125&&this.controllerValue===0){this.channelModeMessage="omnimodeon"}else if(this.controllerNumber===126){this.channelModeMessage="monomodeon"}else if(this.controllerNumber===127){this.channelModeMessage="polymodeon"}break;case 192:this.messageType="programchange";this.program=e.data[1];break;case 208:this.messageType="channelpressure";this.pressure=e.data[1]&127;break;case 224:this.messageType="pitchbendchange";var t=e.data[2]&127;var s=e.data[1]&127;this.pitchBend=(t<<8)+s;break}}return new t(e)};t.exports=s["default"]},{}]},{},[1])(1)})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],14:[function(require,module,exports){!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.NoteParser=t.NoteParser||{})}(this,function(t){"use strict";function n(t,n){return Array(n+1).join(t)}function r(t){return"number"==typeof t}function e(t){return"string"==typeof t}function u(t){return void 0!==t}function c(t,n){return Math.pow(2,(t-69)/12)*(n||440)}function o(){return b}function i(t,n,r){if("string"!=typeof t)return null;var e=b.exec(t);if(!e||!n&&e[4])return null;var u={letter:e[1].toUpperCase(),acc:e[2].replace(/x/g,"##")};u.pc=u.letter+u.acc,u.step=(u.letter.charCodeAt(0)+3)%7,u.alt="b"===u.acc[0]?-u.acc.length:u.acc.length;var o=A[u.step]+u.alt;return u.chroma=o<0?12+o:o%12,e[3]&&(u.oct=+e[3],u.midi=o+12*(u.oct+1),u.freq=c(u.midi,r)),n&&(u.tonicOf=e[4]),u}function f(t){return r(t)?t<0?n("b",-t):n("#",t):""}function a(t){return r(t)?""+t:""}function l(t,n,r){return null===t||void 0===t?null:t.step?l(t.step,t.alt,t.oct):t<0||t>6?null:C.charAt(t)+f(n)+a(r)}function p(t){if((r(t)||e(t))&&t>=0&&t<128)return+t;var n=i(t);return n&&u(n.midi)?n.midi:null}function s(t,n){var r=p(t);return null===r?null:c(r,n)}function d(t){return(i(t)||{}).letter}function m(t){return(i(t)||{}).acc}function h(t){return(i(t)||{}).pc}function v(t){return(i(t)||{}).step}function g(t){return(i(t)||{}).alt}function x(t){return(i(t)||{}).chroma}function y(t){return(i(t)||{}).oct}var b=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,A=[0,2,4,5,7,9,11],C="CDEFGAB";t.regex=o,t.parse=i,t.build=l,t.midi=p,t.freq=s,t.letter=d,t.acc=m,t.pc=h,t.step=v,t.alt=g,t.chroma=x,t.oct=y})},{}],15:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],16:[function(require,module,exports){module.exports=function(player){player.on=function(event,cb){if(arguments.length===1&&typeof event==="function")return player.on("event",event);var prop="on"+event;var old=player[prop];player[prop]=old?chain(old,cb):cb;return player};return player};function chain(fn1,fn2){return function(a,b,c,d){fn1(a,b,c,d);fn2(a,b,c,d)}}},{}],17:[function(require,module,exports){"use strict";var player=require("./player");var events=require("./events");var notes=require("./notes");var scheduler=require("./scheduler");var midi=require("./midi");function SamplePlayer(ac,source,options){return midi(scheduler(notes(events(player(ac,source,options)))))}if(typeof module==="object"&&module.exports)module.exports=SamplePlayer;if(typeof window!=="undefined")window.SamplePlayer=SamplePlayer},{"./events":16,"./midi":18,"./notes":19,"./player":20,"./scheduler":21}],18:[function(require,module,exports){var midimessage=require("midimessage");module.exports=function(player){player.listenToMidi=function(input,options){var started={};var opts=options||{};var gain=opts.gain||function(vel){return vel/127};input.onmidimessage=function(msg){var mm=msg.messageType?msg:midimessage(msg);if(mm.messageType==="noteon"&&mm.velocity===0){mm.messageType="noteoff"}if(opts.channel&&mm.channel!==opts.channel)return;switch(mm.messageType){case"noteon":started[mm.key]=player.play(mm.key,0,{gain:gain(mm.velocity)});break;case"noteoff":if(started[mm.key]){started[mm.key].stop();delete started[mm.key]}break}};return player};return player}},{midimessage:13}],19:[function(require,module,exports){"use strict";var note=require("note-parser");var isMidi=function(n){return n!==null&&n!==[]&&n>=0&&n<129};var toMidi=function(n){return isMidi(n)?+n:note.midi(n)};module.exports=function(player){if(player.buffers){var map=player.opts.map;var toKey=typeof map==="function"?map:toMidi;var mapper=function(name){return name?toKey(name)||name:null};player.buffers=mapBuffers(player.buffers,mapper);var start=player.start;player.start=function(name,when,options){var key=mapper(name);var dec=key%1;if(dec){key=Math.floor(key);options=Object.assign(options||{},{cents:Math.floor(dec*100)})}return start(key,when,options)}}return player};function mapBuffers(buffers,toKey){return Object.keys(buffers).reduce(function(mapped,name){mapped[toKey(name)]=buffers[name];return mapped},{})}},{"note-parser":22}],20:[function(require,module,exports){"use strict";var ADSR=require("adsr");var EMPTY={};var DEFAULTS={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:false,cents:0,loopStart:0,loopEnd:0};function SamplePlayer(ac,source,options){var connected=false;var nextId=0;var tracked={};var out=ac.createGain();out.gain.value=1;var opts=Object.assign({},DEFAULTS,options);var player={context:ac,out:out,opts:opts};if(source instanceof AudioBuffer)player.buffer=source;else player.buffers=source;player.start=function(name,when,options){if(player.buffer&&name!==null)return player.start(null,name,when);var buffer=name?player.buffers[name]:player.buffer;if(!buffer){console.warn("Buffer "+name+" not found.");return}else if(!connected){console.warn("SamplePlayer not connected to any node.");return}var opts=options||EMPTY;when=Math.max(ac.currentTime,when||0);player.emit("start",when,name,opts);var node=createNode(name,buffer,opts);node.id=track(name,node);node.env.start(when);node.source.start(when);player.emit("started",when,node.id,node);if(opts.duration)node.stop(when+opts.duration);return node};player.play=function(name,when,options){return player.start(name,when,options)};player.stop=function(when,ids){var node;ids=ids||Object.keys(tracked);return ids.map(function(id){node=tracked[id];if(!node)return null;node.stop(when);return node.id})};player.connect=function(dest){connected=true;out.connect(dest);return player};player.emit=function(event,when,obj,opts){if(player.onevent)player.onevent(event,when,obj,opts);var fn=player["on"+event];if(fn)fn(when,obj,opts)};return player;function track(name,node){node.id=nextId++;tracked[node.id]=node;node.source.onended=function(){var now=ac.currentTime;node.source.disconnect();node.env.disconnect();node.disconnect();player.emit("ended",now,node.id,node)};return node.id}function createNode(name,buffer,options){var node=ac.createGain();node.gain.value=0;node.connect(out);node.env=envelope(ac,options,opts);node.env.connect(node.gain);node.source=ac.createBufferSource();node.source.buffer=buffer;node.source.connect(node);node.source.loop=options.loop||opts.loop;node.source.playbackRate.value=centsToRate(options.cents||opts.cents);node.source.loopStart=options.loopStart||opts.loopStart;node.source.loopEnd=options.loopEnd||opts.loopEnd;node.stop=function(when){var time=when||ac.currentTime;player.emit("stop",time,name);var stopAt=node.env.stop(time);node.source.stop(stopAt)};return node}}function isNum(x){return typeof x==="number"}var PARAMS=["attack","decay","sustain","release"];function envelope(ac,options,opts){var env=ADSR(ac);var adsr=options.adsr||opts.adsr;PARAMS.forEach(function(name,i){if(adsr)env[name]=adsr[i];else env[name]=options[name]||opts[name]});env.value.value=isNum(options.gain)?options.gain:isNum(opts.gain)?opts.gain:1;return env}function centsToRate(cents){return cents?Math.pow(2,cents/1200):1}module.exports=SamplePlayer},{adsr:1}],21:[function(require,module,exports){"use strict";var isArr=Array.isArray;var isObj=function(o){return o&&typeof o==="object"};var OPTS={};module.exports=function(player){player.schedule=function(time,events){var now=player.context.currentTime;var when=time<now?now:time;player.emit("schedule",when,events);var t,o,note,opts;return events.map(function(event){if(!event)return null;else if(isArr(event)){t=event[0];o=event[1]}else{t=event.time;o=event}if(isObj(o)){note=o.name||o.key||o.note||o.midi||null;opts=o}else{note=o;opts=OPTS}return player.start(note,when+(t||0),opts)})};return player}},{}],22:[function(require,module,exports){"use strict";var REGEX=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function regex(){return REGEX}var SEMITONES=[0,2,4,5,7,9,11];function parse(str,isTonic,tuning){if(typeof str!=="string")return null;var m=REGEX.exec(str);if(!m||!isTonic&&m[4])return null;var p={letter:m[1].toUpperCase(),acc:m[2].replace(/x/g,"##")};p.pc=p.letter+p.acc;p.step=(p.letter.charCodeAt(0)+3)%7;p.alt=p.acc[0]==="b"?-p.acc.length:p.acc.length;p.chroma=SEMITONES[p.step]+p.alt;if(m[3]){p.oct=+m[3];p.midi=p.chroma+12*(p.oct+1);p.freq=midiToFreq(p.midi,tuning)}if(isTonic)p.tonicOf=m[4];return p}function midiToFreq(midi,tuning){return Math.pow(2,(midi-69)/12)*(tuning||440)}var parser={parse:parse,regex:regex,midiToFreq:midiToFreq};var FNS=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];FNS.forEach(function(name){parser[name]=function(src){var p=parse(src);return p&&typeof p[name]!=="undefined"?p[name]:null}});module.exports=parser},{}],23:[function(require,module,exports){"use strict";var load=require("audio-loader");var player=require("sample-player");function instrument(ac,name,options){if(arguments.length===1)return function(n,o){return instrument(ac,n,o)};var opts=options||{};var isUrl=opts.isSoundfontURL||isSoundfontURL;var toUrl=opts.nameToUrl||nameToUrl;var url=isUrl(name)?name:toUrl(name,opts.soundfont,opts.format);return load(ac,url,{only:opts.only||opts.notes}).then(function(buffers){var p=player(ac,buffers,opts).connect(ac.destination);p.url=url;p.name=name;return p})}function isSoundfontURL(name){return/\.js(\?.*)?$/i.test(name)}function nameToUrl(name,sf,format){format=format==="ogg"?format:"mp3";sf=sf==="FluidR3_GM"?sf:"MusyngKite";return"https://gleitz.github.io/midi-js-soundfonts/"+sf+"/"+name+"-"+format+".js"}var Soundfont=require("./legacy");Soundfont.instrument=instrument;Soundfont.nameToUrl=nameToUrl;if(typeof module==="object"&&module.exports)module.exports=Soundfont;if(typeof window!=="undefined")window.Soundfont=Soundfont},{"./legacy":24,"audio-loader":5,"sample-player":17}],24:[function(require,module,exports){"use strict";var parser=require("note-parser");function Soundfont(ctx,nameToUrl){console.warn("new Soundfont() is deprected");console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()");if(!(this instanceof Soundfont))return new Soundfont(ctx);this.nameToUrl=nameToUrl||Soundfont.nameToUrl;this.ctx=ctx;this.instruments={};this.promises=[]}Soundfont.prototype.onready=function(callback){console.warn("deprecated API");console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()");Promise.all(this.promises).then(callback)};Soundfont.prototype.instrument=function(name,options){console.warn("new Soundfont().instrument() is deprecated.");console.log("Please use Soundfont.instrument() instead.");var ctx=this.ctx;name=name||"default";if(name in this.instruments)return this.instruments[name];var inst={name:name,play:oscillatorPlayer(ctx,options)};this.instruments[name]=inst;if(name!=="default"){var promise=Soundfont.instrument(ctx,name,options).then(function(instrument){inst.play=instrument.play;return inst});this.promises.push(promise);inst.onready=function(cb){console.warn("onready is deprecated. Use Soundfont.instrument().then()");promise.then(cb)}}else{inst.onready=function(cb){console.warn("onready is deprecated. Use Soundfont.instrument().then()");cb()}}return inst};function loadBuffers(ac,name,options){console.warn("Soundfont.loadBuffers is deprecate.");console.log("Use Soundfont.instrument(..) and get buffers properties from the result.");return Soundfont.instrument(ac,name,options).then(function(inst){return inst.buffers})}Soundfont.loadBuffers=loadBuffers;function oscillatorPlayer(ctx,defaultOptions){defaultOptions=defaultOptions||{};return function(note,time,duration,options){console.warn("The oscillator player is deprecated.");console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var midi=note>0&&note<129?+note:parser.midi(note);var freq=midi?parser.midiToFreq(midi,440):null;if(!freq)return;duration=duration||.2;options=options||{};var destination=options.destination||defaultOptions.destination||ctx.destination;var vcoType=options.vcoType||defaultOptions.vcoType||"sine";var gain=options.gain||defaultOptions.gain||.4;var vco=ctx.createOscillator();vco.type=vcoType;vco.frequency.value=freq;var vca=ctx.createGain();vca.gain.value=gain;vco.connect(vca);vca.connect(destination);vco.start(time);if(duration>0)vco.stop(time+duration);return vco}}Soundfont.noteToMidi=parser.midi;module.exports=Soundfont},{"note-parser":14}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalPitch=require("tonal-pitch");var tonalTranspose=require("tonal-transpose");var tonalDistance=require("tonal-distance");var toArr=require("as-arr");var isArr=Array.isArray;function hasVal(e){return e||e===0}var asArr=toArr.use(/\s*\|\s*|\s*,\s*|\s+/);function map(fn,list){return arguments.length>1?map(fn)(list):function(l){return asArr(l).map(fn)}}function compact(arr){return asArr(arr).filter(hasVal)}function filter(fn,list){return arguments.length>1?filter(fn)(list):function(l){return asArr(l).filter(fn)}}
function objHeight(p){if(!p)return-Infinity;var f=tonalPitch.fifths(p)*7;var o=tonalPitch.focts(p)||-Math.floor(f/12)-100;return f+o*12}function ascComp(a,b){return objHeight(a)-objHeight(b)}function descComp(a,b){return-ascComp(a,b)}function sort(list,comp){var fn=arguments.length===1||comp===true?ascComp:comp===false?descComp:typeof comp==="function"?comp:ascComp;list=Array.isArray(list)?list.slice():asArr(list);return listFn(function(arr){return arr.sort(fn).filter(hasVal)},list)}var shuffle=listFn(function(arr){var i,t;var m=arr.length;while(m){i=Math.random()*m--|0;t=arr[m];arr[m]=arr[i];arr[i]=t}return arr});function trOct(n){return tonalTranspose.transpose(tonalPitch.pitch(0,n,1))}function rotate(times,list){var arr=asArr(list);var len=arr.length;var n=(times%len+len)%len;return arr.slice(n,len).concat(arr.slice(0,n))}function rotateAsc(times,list){return listFn(function(arr){var len=arr.length;var n=(times%len+len)%len;var head=arr.slice(n,len);var tail=arr.slice(0,n);var s=tonalDistance.semitones(head[len-n-1],tail[0]);if(s<0){var octs=Math.floor(s/12);if(times<0)head=head.map(trOct(octs));else tail=tail.map(trOct(-octs))}return head.concat(tail)},list)}function select(nums,list){if(arguments.length===1)return function(l){return select(nums,l)};var arr=asArr(list);return asArr(nums).map(function(n){return arr[n-1]||null})}function permutations(list){list=asArr(list);if(list.length===0)return[[]];return permutations(list.slice(1)).reduce(function(acc,perm){return acc.concat(list.map(function(e,pos){var new_perm=perm.slice();new_perm.splice(pos,0,list[0]);return new_perm}))},[])}function asPitchStr(p){return tonalPitch.strPitch(p)||p}function listToStr(v){return tonalPitch.isPitch(v)?tonalPitch.strPitch(v):isArr(v)?v.map(asPitchStr):v}function listFn(fn,list){if(arguments.length===1)return function(l){return listFn(fn,l)};var arr=asArr(list).map(tonalPitch.asPitch);var res=fn(arr);return listToStr(res)}exports.asArr=asArr;exports.map=map;exports.compact=compact;exports.filter=filter;exports.sort=sort;exports.shuffle=shuffle;exports.rotate=rotate;exports.rotateAsc=rotateAsc;exports.select=select;exports.permutations=permutations},{"as-arr":2,"tonal-distance":29,"tonal-pitch":45,"tonal-transpose":52}],26:[function(require,module,exports){module.exports={4:["1P 4P 7m 10m",["quartal"]],64:["5P 8P 10M"],5:["1P 5P"],M:["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],M13:["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],M6:["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],M69:["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],M7add13:["1P 3M 5P 6M 7M 9M"],M7b5:["1P 3M 5d 7M"],M7b6:["1P 3M 6m 7M"],M7b9:["1P 3M 5P 7M 9m"],M7sus4:["1P 4P 5P 7M"],M9:["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],M9b5:["1P 3M 5d 7M 9M"],M9sus4:["1P 4P 5P 7M 9M"],Madd9:["1P 3M 5P 9M",["2","add9","add2"]],Maj7:["1P 3M 5P 7M",["maj7","M7"]],Mb5:["1P 3M 5d"],Mb6:["1P 3M 13m"],Msus2:["1P 2M 5P",["add9no3","sus2"]],Msus4:["1P 4P 5P",["sus","sus4"]],addb9:["1P 3M 5P 9m"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],m:["1P 3m 5P",["minor"]],"m#5":["1P 3m 5A",["m+","mb6"]],m11:["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],m11b5:["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],m13:["1P 3m 5P 7m 9M 11P 13M",["_13"]],m6:["1P 3m 4P 5P 13M",["_6"]],m69:["1P 3m 5P 6M 9M",["_69"]],m7:["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],m7add11:["1P 3m 5P 7m 11P",["m7add4"]],m7b5:["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],m9:["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],m9b5:["1P 3m 7m 12d 2M",["h9","-9b5"]],mMaj7:["1P 3m 5P 7M",["mM7","_M7"]],mMaj7b6:["1P 3m 5P 6m 7M",["mM7b6"]],mM9:["1P 3m 5P 7M 9M",["mMaj9","-M9"]],mM9b6:["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],mb6M7:["1P 3m 6m 7M"],mb6b9:["1P 3m 6m 9m"],o:["1P 3m 5d",["mb5","dim"]],o7:["1P 3m 5d 13M",["diminished","m6b5","dim7"]],o7M7:["1P 3m 5d 6M 7M"],oM7:["1P 3m 5d 7M"],sus24:["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],madd4:["1P 3m 4P 5P"],madd9:["1P 3m 5P 9M"]}},{}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalDictionary=require("tonal-dictionary");var tonalArray=require("tonal-array");var tonalNote=require("tonal-note");var noteParser=require("note-parser");var tonalHarmonizer=require("tonal-harmonizer");var DATA=require("./chords.json");var dict=tonalDictionary.dictionary(DATA,function(str){return str.split(" ")});var names=dict.keys;function get(type,tonic){if(arguments.length===1)return function(t){return get(type,t)};var ivls=dict.get(type);return ivls?tonalHarmonizer.harmonize(ivls,tonic):null}function notes(chord){var p=parse(chord);var ivls=dict.get(p.type);return ivls?tonalHarmonizer.harmonize(ivls,p.tonic):tonalArray.compact(tonalArray.map(tonalNote.note,chord))}function intervals(name){var p=parse(name);return dict.get(p.type)||[]}function isKnownChord(name){return intervals(name).length>0}var detect=tonalDictionary.detector(dict,"");function position(chord){var pcs=tonalArray.map(tonalNote.pc,chord);var sorted=sortTriads(pcs);return sorted?sorted.indexOf(pcs[0]):null}function inversion(num,chord){if(arguments.length===1)return function(c){return inversion(num,c)};var sorted=sortTriads(chord);return sorted?tonalArray.rotate(num,sorted):[]}function sortTriads(chord){var all=tonalArray.permutations(notes(chord).map(tonalNote.pc));for(var i=0;i<all.length;i++){var ivls=tonalHarmonizer.intervallic(all[i]);if(areTriads(ivls))return all[i]}return null}function areTriads(list){for(var i=0;i<list.length;i++){if(list[i][0]!=="3")return false}return true}function parse(name){var p=noteParser.regex().exec(name);if(!p)return{type:name,tonic:false};return!p[4]?{type:p[3],tonic:p[1]+p[2]}:p[3]==="7"||p[3]==="6"?{type:p[3]+p[4],tonic:p[1]+p[2]}:{type:p[4],tonic:p[1]+p[2]+p[3]}}exports.names=names;exports.get=get;exports.notes=notes;exports.intervals=intervals;exports.isKnownChord=isKnownChord;exports.detect=detect;exports.position=position;exports.inversion=inversion;exports.parse=parse},{"./chords.json":26,"note-parser":14,"tonal-array":25,"tonal-dictionary":28,"tonal-harmonizer":32,"tonal-note":37}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalArray=require("tonal-array");var tonalNote=require("tonal-note");var tonalPcset=require("tonal-pcset");function id(x){return x}function dictionary(raw,parse){parse=parse||id;var byKey={};var names=Object.keys(raw);var aliases=[];names.forEach(function(k){var value=parse(raw[k][0]);byKey[k]=value;if(raw[k][1]){raw[k][1].forEach(function(alias){byKey[alias]=value;aliases.push(alias)})}});return{get:function(n){return byKey[n]},keys:function(all,filter){var keys=all?names.concat(aliases):names.slice();return typeof filter!=="function"?keys:keys.filter(function(k){return filter(k,byKey[k])})}}}function detector(dict,build){var isSep=typeof build==="string";var isFn=typeof build==="function";var nameByChroma=dict.keys(false).reduce(function(map$$1,key){map$$1[tonalPcset.chroma(dict.get(key))]=key;return map$$1},{});return function(notes){notes=tonalArray.sort(tonalArray.map(tonalNote.pc,notes));var sets=tonalPcset.chromaModes(notes);return tonalArray.compact(sets.map(function(set,i){var type=nameByChroma[set];if(!type)return null;var tonic=notes[i];return isSep?tonic+build+type:isFn?build(type,tonic):[type,tonic]}))}}exports.dictionary=dictionary;exports.detector=detector},{"tonal-array":25,"tonal-note":37,"tonal-pcset":38}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalPitch=require("tonal-pitch");function substr(a,b){if(!a||!b||a[1].length!==b[1].length)return null;var f=tonalPitch.fifths(b)-tonalPitch.fifths(a);if(tonalPitch.isPC(a))return tonalPitch.pitch(f,-Math.floor(f*7/12),1);var o=tonalPitch.focts(b)-tonalPitch.focts(a);var d=tonalPitch.height(b)-tonalPitch.height(a)<0?-1:1;return tonalPitch.pitch(d*f,d*o,d)}function interval(a,b){if(arguments.length===1)return function(b){return interval(a,b)};var pa=tonalPitch.asPitch(a);var pb=tonalPitch.asPitch(b);var i=substr(pa,pb);return a===pa&&b===pb?i:tonalPitch.strIvl(i)}function semitones(a,b){var i=substr(tonalPitch.asPitch(a),tonalPitch.asPitch(b));return i?tonalPitch.height(i):null}exports.interval=interval;exports.semitones=semitones},{"tonal-pitch":45}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function isNum(n){return typeof n==="number"}var FIFTHS=[0,2,4,-1,1,3,5];function fOcts(f){return Math.floor(f*7/12)}var FIFTH_OCTS=FIFTHS.map(fOcts);function encode(step,alt,oct){var f=FIFTHS[step]+7*alt;if(!isNum(oct))return[f];var o=oct-FIFTH_OCTS[step]-4*alt;return[f,o]}function unaltered(f){var i=(f+1)%7;return i<0?7+i:i}var STEPS=[3,0,4,1,5,2,6];function decode(f,o){var step=STEPS[unaltered(f)];var alt=Math.floor((f+1)/7);if(!isNum(o))return[step,alt];var oct=o+4*alt+FIFTH_OCTS[step];return[step,alt,oct]}exports.encode=encode;exports.decode=decode},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalMidi=require("tonal-midi");function round(m,fn){m=m||m===0?Math.pow(10,m):false;return function(v){v=fn(v);return v===null?null:m?Math.round(v*m)/m:v}}function eqTempFreq(ref,max,note$$1){if(arguments.length>2)return eqTempFreq(ref,max)(note$$1);return round(max,function(p){var m=tonalMidi.toMidi(p);return m?Math.pow(2,(m-69)/12)*ref:null})}var toFreq=eqTempFreq(440,2);function eqTempFreqToMidi(ref,max,freq){if(arguments.length>2)return eqTempFreqToMidi(ref,max)(freq);return round(max,function(freq){return 12*(Math.log(freq)-Math.log(ref))/Math.log(2)+69})}var toMidi$1=eqTempFreqToMidi(440,2);function note$1(freq,useSharps){return tonalMidi.note(toMidi$1(freq),useSharps)}function cents(base,freq){var b=toFreq(base)||base;var f=toFreq(freq)||freq;return Math.round(1200*(Math.log(f/b)/Math.log(2)))}exports.eqTempFreq=eqTempFreq;exports.toFreq=toFreq;exports.eqTempFreqToMidi=eqTempFreqToMidi;exports.toMidi=toMidi$1;exports.note=note$1;exports.cents=cents},{"tonal-midi":35}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalTranspose=require("tonal-transpose");var tonalDistance=require("tonal-distance");var tonalArray=require("tonal-array");function harmonics(list){var a=tonalArray.asArr(list);return a.length?tonalArray.compact(a.map(tonalDistance.interval(a[0]))):a}function intervallic(notes){var dist=[];notes=tonalArray.asArr(notes);for(var i=1;i<notes.length;i++){dist.push(tonalDistance.interval(notes[i-1],notes[i]))}return dist}function harmonize(list,pitch){if(arguments.length>1)return harmonize(list)(pitch);return function(tonic){return tonalArray.compact(tonalArray.map(tonalTranspose.transpose(tonic||"P1"),list))}}exports.harmonics=harmonics;exports.intervallic=intervallic;exports.harmonize=harmonize},{"tonal-array":25,"tonal-distance":29,"tonal-transpose":52}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var intervalNotation=require("interval-notation");var tonalPitch=require("tonal-pitch");function toInterval(ivl){var i=tonalPitch.asIvlPitch(ivl);return i?tonalPitch.strIvl(i):null}function num(ivl){var p=props(ivl);return p?p.num:null}function value(ivl){var p=props(ivl);return p?p.num*p.dir:null}function props(ivl){var i=tonalPitch.asIvlPitch(ivl);if(!i)return null;var d=tonalPitch.decode(i);return{num:d[0]+1+d[2]*7,alt:d[1],dir:i[2]}}function fromProps(props){if(!props||props.num<1)return null;var octs=Math.floor(props.num/8);var simple=props.num-7*octs;return intervalNotation.build(simple,props.alt||0,octs,props.dir)}function semitones(ivl){var i=tonalPitch.asIvlPitch(ivl);return i?tonalPitch.height(i):null}var IN=[1,2,2,3,3,4,5,5,6,6,7,7];var IQ="P m M m M P d P m M m M".split(" ");function fromSemitones(num){var d=num<0?-1:1;var n=Math.abs(num);var c=n%12;var o=Math.floor(n/12);return d*(IN[c]+7*o)+IQ[c]}var CLASSES=[0,1,2,3,4,5,6,5,4,3,2,1];function ic(ivl){var i=tonalPitch.asIvlPitch(ivl);var s=i?tonalPitch.chr(i):Math.round(ivl);return isNaN(s)?null:CLASSES[Math.abs(s)%12]}var TYPES="PMMPPMM";function type(ivl){var i=tonalPitch.asIvlPitch(ivl);return i?TYPES[tonalPitch.decode(i)[0]]:null}var invert=tonalPitch.ivlFn(function(i){var d=tonalPitch.decode(i);var step=(7-d[0])%7;var alt=TYPES[d[0]]==="P"?-d[1]:-(d[1]+1);return tonalPitch.encode(step,alt,d[2],tonalPitch.dir(i))});var simplify=tonalPitch.ivlFn(function(i){var dec=tonalPitch.decode(i);if(dec[0]!==0||dec[2]!==1)dec[2]=0;return tonalPitch.encode(dec[0],dec[1],dec[2],tonalPitch.dir(i))});exports.toInterval=toInterval;exports.num=num;exports.value=value;exports.props=props;exports.fromProps=fromProps;exports.semitones=semitones;exports.fromSemitones=fromSemitones;exports.ic=ic;exports.type=type;exports.invert=invert;exports.simplify=simplify},{"interval-notation":10,"tonal-pitch":45}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalNotation=require("tonal-notation");var tonalTranspose=require("tonal-transpose");var tonalNote=require("tonal-note");var tonalRange=require("tonal-range");var tonalArray=require("tonal-array");var tonalHarmonizer=require("tonal-harmonizer");var MODES=["ionian","dorian","phrygian","lydian","mixolydian","aeolian","locrian","major","minor"];var FIFTHS=[0,2,4,-1,1,3,5,0,3];var SCALES=[0,1,2,3,4,5,6,0,5].map(function(n){return tonalHarmonizer.harmonics(tonalArray.rotate(n,["C","D","E","F","G","A","B"]))});function toKey(t,m){return!t?m:t+" "+m}function majorKey(n){return toKey(tonalTranspose.trFifths("C",n),"major")}function modeNum(mode){return FIFTHS[MODES.indexOf(mode)]}function validMode(m){m=m.trim().toLowerCase();return MODES.indexOf(m)===-1?null:m}function props(str){if(typeof str!=="string")return null;var ndx=str.indexOf(" ");var key;if(ndx===-1){var p=tonalNote.pc(str);key=p?{tonic:p,mode:"major"}:{tonic:false,mode:validMode(str)}}else{key={tonic:tonalNote.pc(str.slice(0,ndx)),mode:validMode(str.slice(ndx+1))}}return key.mode?key:null}function isKeyName(name){return props(name)!==null}function tonic(key){return(props(key)||key||{}).tonic||null}function mode(key){return(props(key)||key||{}).mode||null}function relative(rel,key){if(arguments.length===1)return function(k){return relative(rel,k)};rel=props(rel);if(!rel||rel.tonic)return null;key=props(key);if(!key||!key.tonic)return null;var tonic=tonalTranspose.trFifths(key.tonic,modeNum(rel.mode)-modeNum(key.mode));return toKey(tonic,rel.mode)}function alteredNotes(key){var alt=alteration(key);return alt===null?null:alt<0?tonalRange.numeric([-1,alt]).map(tonalTranspose.trFifths("F")):tonalRange.numeric([1,alt]).map(tonalTranspose.trFifths("B"))}function modes(alias){return alias?MODES.slice():MODES.slice(0,-2)}function fromAlter(n){return typeof n==="number"?majorKey(n):null}function fromAcc(s){return tonalNotation.areSharps(s)?majorKey(s.length):tonalNotation.areFlats(s)?majorKey(-s.length):null}function scale(key){var p=props(key);if(!p||!p.tonic)return null;return tonalHarmonizer.harmonize(SCALES[MODES.indexOf(p.mode)],p.tonic)}function alteration(key){var k=props(key);if(!k||!k.tonic)return null;var toMajor=modeNum(k.mode);var toC=tonalNote.pcFifths(k.tonic);return toC-toMajor}function signature(key){return tonalNotation.toAcc(alteration(key))}var accidentals=signature;exports.props=props;exports.isKeyName=isKeyName;exports.tonic=tonic;exports.mode=mode;exports.relative=relative;exports.alteredNotes=alteredNotes;exports.modes=modes;exports.fromAlter=fromAlter;exports.fromAcc=fromAcc;exports.scale=scale;exports.alteration=alteration;exports.signature=signature;exports.accidentals=accidentals},{"tonal-array":25,"tonal-harmonizer":32,"tonal-notation":36,"tonal-note":37,"tonal-range":48,"tonal-transpose":52}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var noteParser=require("note-parser");function toMidi(val){if(Array.isArray(val)&&val.length===2)return val[0]*7+val[1]*12+12;return noteParser.midi(val)}var FLATS="C Db D Eb E F Gb G Ab A Bb B".split(" ");var SHARPS="C C# D D# E F F# G G# A A# B".split(" ");function note(num,sharps){if(num===true||num===false)return function(m){return note(m,num)};num=Math.round(num);var pcs=sharps===true?SHARPS:FLATS;var pc=pcs[num%12];var o=Math.floor(num/12)-1;return pc+o}exports.toMidi=toMidi;exports.note=note},{"note-parser":14}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function toStep(l){var s="CDEFGAB".indexOf(l.toUpperCase());return s<0?null:s}function isStep(d){return!(d<0||d>6)}function toLetter(s){return isStep(s)?"CDEFGAB".charAt(s):null}function areFlats(s){return/^b+$/.test(s)}function areSharps(s){return/^#+$/.test(s)}function toAlt(s){return s===""?0:areFlats(s)?-s.length:areSharps(s)?s.length:null}function fillStr(s,num){return Array(num+1).join(s)}function toAcc(n){return!n?"":n<0?fillStr("b",-n):fillStr("#",n)}exports.toStep=toStep;exports.isStep=isStep;exports.toLetter=toLetter;exports.areFlats=areFlats;exports.areSharps=areSharps;exports.toAlt=toAlt;exports.toAcc=toAcc},{}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var noteParser=require("note-parser");var tonalPitch=require("tonal-pitch");var tonalTranspose=require("tonal-transpose");var tonalMidi=require("tonal-midi");var tonalFreq=require("tonal-freq");var midi=tonalMidi.toMidi;var fromMidi=tonalMidi.note;var freq=tonalFreq.toFreq;function chroma(n){var p=tonalPitch.asNotePitch(n);return p?tonalPitch.chr(p):null}function note$1(n){var p=tonalPitch.asNotePitch(n);return p?tonalPitch.strNote(p):null}const name=note$1;function props(n){var p=tonalPitch.asNotePitch(n);if(!p)return null;var d=tonalPitch.decode(p);return{step:d[0],alt:d[1],oct:d[2]}}function fromProps(props){return props?noteParser.build(props.step,props.alt,props.oct):null}function getProp(name){return function(n){var p=props(n);return p?p[name]:null}}var oct=getProp("oct");var step=getProp("step");function pcFifths(note$$1){var p=tonalPitch.asNotePitch(note$$1);return p?tonalPitch.fifths(p):null}var alt=getProp("alt");function pc(n){var p=tonalPitch.asNotePitch(n);return p?tonalPitch.strNote([p[0],[tonalPitch.fifths(p)]]):null}var ASC=tonalPitch.parseIvl("2d");var DESC=tonalPitch.parseIvl("-2d");function enharmonics(pitch){var notes=[];notes.push(tonalTranspose.transpose(DESC,pitch));if(notes[0]===null)return null;notes.push(pitch);notes.push(tonalTranspose.transpose(ASC,pitch));return notes}function simplify(pitch){return enharmonics(pitch).reduce(function(simple,next){if(!simple)return next;return simple.length>next.length?next:simple},null)}exports.midi=midi;exports.fromMidi=fromMidi;exports.freq=freq;exports.chroma=chroma;exports.note=note$1;exports.name=name;exports.props=props;exports.fromProps=fromProps;exports.oct=oct;exports.step=step;exports.pcFifths=pcFifths;exports.alt=alt;exports.pc=pc;exports.enharmonics=enharmonics;exports.simplify=simplify},{"note-parser":14,"tonal-freq":31,"tonal-midi":35,"tonal-pitch":45,"tonal-transpose":52}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalPitch=require("tonal-pitch");var tonalNote=require("tonal-note");var tonalArray=require("tonal-array");var tonalTranspose=require("tonal-transpose");function chrToInt(set){return parseInt(chroma(set),2)}function pitchChr(p){p=tonalPitch.asPitch(p);return p?tonalPitch.chr(p):null}function chroma(set){if(isChroma(set))return set;var b=[0,0,0,0,0,0,0,0,0,0,0,0];tonalArray.map(pitchChr,set).forEach(function(i){b[i]=1});return b.join("")}function notes(notes){var pcs=tonalArray.map(tonalNote.pc,notes);if(!pcs.length)return pcs;var tonic=pcs[0];var rotated=tonalArray.rotate(pitchChr(tonic),chroma(pcs).split("")).join("");return fromChroma(rotated,tonic)}function chromaModes(set,normalize){normalize=normalize!==false;var binary=chroma(set).split("");return tonalArray.compact(binary.map(function(_,i){var r=tonalArray.rotate(i,binary);return normalize&&r[0]==="0"?null:r.join("")}))}var REGEX=/^[01]{12}$/;function isChroma(set){return REGEX.test(set)}var IVLS="1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function fromChroma(binary,tonic){if(arguments.length===1)return function(t){return fromChroma(binary,t)};if(!isChroma(binary))return null;tonic=tonic||"P1";return tonalArray.compact(binary.split("").map(function(d,i){return d==="1"?tonalTranspose.transpose(IVLS[i],tonic):null}))}function equal(s1,s2){if(arguments.length===1)return function(s){return equal(s1,s)};return chroma(s1)===chroma(s2)}function subset(set,test){if(arguments.length===1)return function(t){return subset(set,t)};test=chrToInt(test);return(test&chrToInt(set))===test}function superset(set,test){if(arguments.length===1)return function(t){return superset(set,t)};test=chrToInt(test);return(test|chrToInt(set))===test}function includes(set,note){if(arguments.length>1)return includes(set)(note);set=chroma(set);return function(note){return set[pitchChr(note)]==="1"}}function filter(set,notes){if(arguments.length===1)return function(n){return filter(set,n)};return tonalArray.asArr(notes).filter(includes(set))}exports.chroma=chroma;exports.notes=notes;exports.chromaModes=chromaModes;exports.isChroma=isChroma;exports.fromChroma=fromChroma;exports.equal=equal;exports.subset=subset;exports.superset=superset;exports.includes=includes;exports.filter=filter},{"tonal-array":25,"tonal-note":42,"tonal-pitch":45,"tonal-transpose":52}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function isNum(n){return typeof n==="number"}var FIFTHS=[0,2,4,-1,1,3,5];function fOcts(f){return Math.floor(f*7/12)}var FIFTH_OCTS=FIFTHS.map(fOcts);function encode(step,alt,oct){var f=FIFTHS[step]+7*alt;if(!isNum(oct))return[f];var o=oct-FIFTH_OCTS[step]-4*alt;return[f,o]}function unaltered(f){var i=(f+1)%7;return i<0?7+i:i}var STEPS=[3,0,4,1,5,2,6];function decode(f,o){var step=STEPS[unaltered(f)];var alt=Math.floor((f+1)/7);if(!isNum(o))return[step,alt];var oct=o+4*alt+FIFTH_OCTS[step];return[step,alt,oct]}exports.encode=encode;exports.decode=decode},{}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalMidi=require("tonal-midi");function toEqualTemp(ref){return function(p){var m=tonalMidi.fromNote(p);return m?Math.pow(2,(m-69)/12)*ref:null}}var toFreq=toEqualTemp(440);function fromEqualTemp(ref){return function(freq){var midiNum=12*(Math.log(freq)-Math.log(ref))/Math.log(2)+69;return Math.round(midiNum)}}var midiFromFreq=fromEqualTemp(440);function fromFreq(freq){return tonalMidi.toNote(midiFromFreq(freq))}function cents(base,freq){var b=toFreq(base)||base;var f=toFreq(freq)||freq;return 1200*(Math.log(f/b)/Math.log(2))}exports.toEqualTemp=toEqualTemp;exports.toFreq=toFreq;exports.fromEqualTemp=fromEqualTemp;exports.midiFromFreq=midiFromFreq;exports.fromFreq=fromFreq;exports.cents=cents},{"tonal-midi":41}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopDefault(ex){return ex&&typeof ex==="object"&&"default"in ex?ex["default"]:ex}var parser=_interopDefault(require("note-parser"));function isValidNote(m){return parser.midi(m)!==null}function fromNote(val){if(Array.isArray(val)&&val.length===2)return val[0]*7+val[1]*12+12;return parser.midi(val)}var FLATS="C Db D Eb E F Gb G Ab A Bb B".split(" ");var SHARPS="C C# D D# E F F# G G# A A# B".split(" ");function toNote(num,sharps){if(num===true||num===false)return function(m){return toNote(m,num)};var pcs=sharps===true?SHARPS:FLATS;var pc=pcs[num%12];var o=Math.floor(num/12)-1;return pc+o}exports.isValidNote=isValidNote;exports.fromNote=fromNote;exports.toNote=toNote},{"note-parser":14}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var noteParser=require("note-parser");var tonalPitch=require("tonal-pitch");var tonalTranspose=require("tonal-transpose");var tonalMidi=require("tonal-midi");var tonalFreq=require("tonal-freq");var midi=tonalMidi.toMidi;var fromMidi=tonalMidi.note;var freq=tonalFreq.toFreq;function chroma(n){var p=tonalPitch.asNotePitch(n);return p?tonalPitch.chr(p):null}function note$1(n){var p=tonalPitch.asNotePitch(n);return p?tonalPitch.strNote(p):null}function props(n){var p=tonalPitch.asNotePitch(n);if(!p)return null;var d=tonalPitch.decode(p);return{step:d[0],alt:d[1],oct:d[2]}}function fromProps(props){return props?noteParser.build(props.step,props.alt,props.oct):null}function getProp(name){return function(n){var p=props(n);return p?p[name]:null}}var oct=getProp("oct");var step=getProp("step");function pcFifths(note){var p=tonalPitch.asNotePitch(note);return p?tonalPitch.fifths(p):null}var alt=getProp("alt");function pc(n){var p=tonalPitch.asNotePitch(n);return p?tonalPitch.strNote([p[0],[tonalPitch.fifths(p)]]):null}var ASC=tonalPitch.parseIvl("2d");var DESC=tonalPitch.parseIvl("-2d");function enharmonics(pitch){var notes=[];notes.push(tonalTranspose.transpose(DESC,pitch));if(notes[0]===null)return null;notes.push(pitch);notes.push(tonalTranspose.transpose(ASC,pitch));return notes}function simplify(pitch){return enharmonics(pitch).reduce(function(simple,next){if(!simple)return next;return simple.length>next.length?next:simple},null)}exports.midi=midi;exports.fromMidi=fromMidi;exports.freq=freq;exports.chroma=chroma;exports.note=note$1;exports.props=props;exports.fromProps=fromProps;exports.oct=oct;exports.step=step;exports.pcFifths=pcFifths;exports.alt=alt;exports.pc=pc;exports.enharmonics=enharmonics;exports.simplify=simplify},{"note-parser":14,"tonal-freq":40,"tonal-midi":41,"tonal-pitch":43,"tonal-transpose":44}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var noteParser=require("note-parser");var intervalNotation=require("interval-notation");var tonalEncoding=require("tonal-encoding");function pitch(fifths,focts,dir){return dir?["tnlp",[fifths,focts],dir]:["tnlp",[fifths,focts]]}function isPitch(p){return Array.isArray(p)&&p[0]==="tnlp"}function encode$1(s,a,o,dir){return dir?["tnlp",tonalEncoding.encode(s,a,o),dir]:["tnlp",tonalEncoding.encode(s,a,o)]}function decode$1(p){return tonalEncoding.decode.apply(null,p[1])}function pType(p){return!isPitch(p)?null:p[2]?"ivl":"note"}function isNotePitch(p){return pType(p)==="note"}function isIvlPitch(p){return pType(p)==="ivl"}function isPC(p){return isPitch(p)&&p[1].length===1}function dir(p){return p[2]===-1?-1:1}function fifths(p){return p[2]===-1?-p[1][0]:p[1][0]}function focts(p){return p[2]===-1?-p[1][1]:p[1][1]}function height(p){return fifths(p)*7+focts(p)*12}function chr(p){var f=fifths(p);return 7*f-12*Math.floor(f*7/12)}function memoize(fn){var cache={};return function(str){if(typeof str!=="string")return null;return cache[str]||(cache[str]=fn(str))}}var parseNote=memoize(function(s){var p=noteParser.parse(s);return p?encode$1(p.step,p.alt,p.oct):null});var parseIvl=memoize(function(s){var p=intervalNotation.parse(s);if(!p)return null;return p?encode$1(p.simple-1,p.alt,p.oct,p.dir):null});function parsePitch(s){return parseNote(s)||parseIvl(s)}function asNotePitch(p){return isNotePitch(p)?p:parseNote(p)}function asIvlPitch(p){return isIvlPitch(p)?p:parseIvl(p)}function asPitch(p){return isPitch(p)?p:parsePitch(p)}function strNote(p){if(!isNotePitch(p))return null;return noteParser.build.apply(null,decode$1(p))}function strIvl(p){if(!isIvlPitch(p))return null;var d=decode$1(p);var num=d[0]+1+7*d[2];return p[2]*num+intervalNotation.altToQ(num,d[1])}function strPitch(p){return strNote(p)||strIvl(p)}function decorator(is,parse,str){return function(fn){return function(v){var i=is(v);if(i)return fn(v);var p=parse(v);return p?str(fn(p)):null}}}var noteFn=decorator(isNotePitch,parseNote,strNote);var ivlFn=decorator(isIvlPitch,parseIvl,strIvl);var pitchFn=decorator(isPitch,parsePitch,strPitch);exports.pitch=pitch;exports.isPitch=isPitch;exports.encode=encode$1;exports.decode=decode$1;exports.pType=pType;exports.isNotePitch=isNotePitch;exports.isIvlPitch=isIvlPitch;exports.isPC=isPC;exports.dir=dir;exports.fifths=fifths;exports.focts=focts;exports.height=height;exports.chr=chr;exports.parseNote=parseNote;exports.parseIvl=parseIvl;exports.parsePitch=parsePitch;exports.asNotePitch=asNotePitch;exports.asIvlPitch=asIvlPitch;exports.asPitch=asPitch;exports.strNote=strNote;exports.strIvl=strIvl;exports.strPitch=strPitch;exports.noteFn=noteFn;exports.ivlFn=ivlFn;exports.pitchFn=pitchFn},{"interval-notation":10,"note-parser":14,"tonal-encoding":39}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalPitch=require("tonal-pitch");function trBy(i,p){var t=tonalPitch.pType(p);if(!t)return null;var f=tonalPitch.fifths(i)+tonalPitch.fifths(p);if(tonalPitch.isPC(p))return["tnlp",[f]];var o=tonalPitch.focts(i)+tonalPitch.focts(p);if(t==="note")return["tnlp",[f,o]];var d=tonalPitch.height(i)+tonalPitch.height(p)<0?-1:1;return["tnlp",[d*f,d*o],d]}function transpose(a,b){if(arguments.length===1)return function(b){return transpose(a,b)};var pa=tonalPitch.asPitch(a);var pb=tonalPitch.asPitch(b);var r=tonalPitch.isIvlPitch(pa)?trBy(pa,pb):tonalPitch.isIvlPitch(pb)?trBy(pb,pa):null;return a===pa&&b===pb?r:tonalPitch.strPitch(r)}function trFifths(t,n){if(arguments.length>1)return trFifths(t)(n);return function(n){return transpose(t,tonalPitch.pitch(n,0,1))}}exports.transpose=transpose;exports.trFifths=trFifths},{"tonal-pitch":43}],45:[function(require,module,exports){"use strict"
;Object.defineProperty(exports,"__esModule",{value:true});var noteParser=require("note-parser");var intervalNotation=require("interval-notation");var tonalEncoding=require("tonal-encoding");function pitch(fifths,focts,dir){return dir?["tnlp",[fifths,focts],dir]:["tnlp",[fifths,focts]]}function isPitch(p){return Array.isArray(p)&&p[0]==="tnlp"}function encode$1(s,a,o,dir){return dir?["tnlp",tonalEncoding.encode(s,a,o),dir]:["tnlp",tonalEncoding.encode(s,a,o)]}function decode$1(p){return tonalEncoding.decode.apply(null,p[1])}function pType(p){return!isPitch(p)?null:p[2]?"ivl":"note"}function isNotePitch(p){return pType(p)==="note"}function isIvlPitch(p){return pType(p)==="ivl"}function isPC(p){return isPitch(p)&&p[1].length===1}function dir(p){return p[2]===-1?-1:1}function fifths(p){return p[2]===-1?-p[1][0]:p[1][0]}function focts(p){return p[2]===-1?-p[1][1]:p[1][1]}function height(p){return fifths(p)*7+focts(p)*12}function chr(p){var f=fifths(p);return 7*f-12*Math.floor(f*7/12)}function memoize(fn){var cache={};return function(str){if(typeof str!=="string")return null;return cache[str]||(cache[str]=fn(str))}}var parseNote=memoize(function(s){var p=noteParser.parse(s);return p?encode$1(p.step,p.alt,p.oct):null});var parseIvl=memoize(function(s){var p=intervalNotation.parse(s);if(!p)return null;return p?encode$1(p.simple-1,p.alt,p.oct,p.dir):null});function parsePitch(s){return parseNote(s)||parseIvl(s)}function asNotePitch(p){return isNotePitch(p)?p:parseNote(p)}function asIvlPitch(p){return isIvlPitch(p)?p:parseIvl(p)}function asPitch(p){return isPitch(p)?p:parsePitch(p)}function strNote(p){if(!isNotePitch(p))return null;return noteParser.build.apply(null,decode$1(p))}function strIvl(p){if(!isIvlPitch(p))return null;var d=decode$1(p);var num=d[0]+1+7*d[2];return p[2]*num+intervalNotation.altToQ(num,d[1])}function strPitch(p){return strNote(p)||strIvl(p)}function decorator(is,parse$$1,str){return function(fn){return function(v){var i=is(v);if(i)return fn(v);var p=parse$$1(v);return p?str(fn(p)):null}}}var noteFn=decorator(isNotePitch,parseNote,strNote);var ivlFn=decorator(isIvlPitch,parseIvl,strIvl);var pitchFn=decorator(isPitch,parsePitch,strPitch);exports.pitch=pitch;exports.isPitch=isPitch;exports.encode=encode$1;exports.decode=decode$1;exports.pType=pType;exports.isNotePitch=isNotePitch;exports.isIvlPitch=isIvlPitch;exports.isPC=isPC;exports.dir=dir;exports.fifths=fifths;exports.focts=focts;exports.height=height;exports.chr=chr;exports.parseNote=parseNote;exports.parseIvl=parseIvl;exports.parsePitch=parsePitch;exports.asNotePitch=asNotePitch;exports.asIvlPitch=asIvlPitch;exports.asPitch=asPitch;exports.strNote=strNote;exports.strIvl=strIvl;exports.strPitch=strPitch;exports.noteFn=noteFn;exports.ivlFn=ivlFn;exports.pitchFn=pitchFn},{"interval-notation":10,"note-parser":14,"tonal-encoding":30}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalArray=require("tonal-array");function notes(notes){return tonalArray.sort(notes).filter(function(n,i,arr){return i===0||n!==arr[i-1]})}exports.notes=notes},{"tonal-array":25}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalNote=require("tonal-note");var tonalInterval=require("tonal-interval");var tonalArray=require("tonal-array");var tonalTranspose=require("tonal-transpose");var tonalDistance=require("tonal-distance");var tonalChord=require("tonal-chord");var tonalNotation=require("tonal-notation");function abstract(chords,tonic){tonic=tonalNote.pc(tonic);chords=tonalArray.map(tonalChord.parse,chords);var tonics=tonalArray.compact(chords.map(function(x){return x.tonic}));if(tonics.length!==chords.length)return null;return tonics.map(function(t,i){var p=tonalInterval.props(tonalDistance.interval(tonic,t));return buildRoman(p.num-1,p.alt,chords[i].type)})}var NUMS=["I","II","III","IV","V","VI","VII"];function buildRoman(num,alt,element){return tonalNotation.toAcc(alt)+NUMS[num%7]+(element||"")}function concrete(chords,tonic){return tonalArray.map(function(e){var r=parseRomanChord(e);return r?tonalTranspose.transpose(r.root,tonic)+r.type:null},chords)}var ROMAN=/^\s*(b|bb|#|##|)(IV|III|II|I|VII|VI|V|iv|iii|ii|i|vii|vi|v)\s*(.*)\s*$/;function romanRegex(){return ROMAN}var NUM={i:0,ii:1,iii:2,iv:3,v:4,vi:5,vii:6};function parseRomanChord(str){var m=ROMAN.exec(str);if(!m)return null;var num=NUM[m[2].toLowerCase()]+1;var alt=m[1].length;if(m[1][0]==="b")alt=-alt;return{root:tonalInterval.fromProps({num:num,alt:alt,dir:1}),type:m[3]}}exports.abstract=abstract;exports.buildRoman=buildRoman;exports.concrete=concrete;exports.romanRegex=romanRegex;exports.parseRomanChord=parseRomanChord},{"tonal-array":25,"tonal-chord":27,"tonal-distance":29,"tonal-interval":33,"tonal-notation":36,"tonal-note":37,"tonal-transpose":52}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalArray=require("tonal-array");var tonalTranspose=require("tonal-transpose");var tonalMidi=require("tonal-midi");var tonalPcset=require("tonal-pcset");function isNum(n){return typeof n==="number"}function asNum(n){return isNum(n)?n:tonalMidi.toMidi(n)}function ascR(b,n){for(var a=[];n--;a[n]=n+b);return a}function descR(b,n){for(var a=[];n--;a[n]=b-n);return a}function ran(a,b){return a===null||b===null?[]:a<b?ascR(a,b-a+1):descR(a,a-b+1)}function numeric(list){return tonalArray.asArr(list).map(asNum).reduce(function(r,n,i){if(i===1)return ran(r,n);var last=r[r.length-1];return r.concat(ran(last,n).slice(1))})}function chromatic(list,sharps){return tonalArray.map(tonalMidi.note(sharps===true),numeric(list))}function fifths(tonic,range){return numeric(range).map(tonalTranspose.trFifths(tonic))}function pitchSet(set,range){if(arguments.length===1)return function(l){return pitchSet(set,l)};return tonalPcset.filter(set,chromatic(range))}exports.numeric=numeric;exports.chromatic=chromatic;exports.fifths=fifths;exports.pitchSet=pitchSet},{"tonal-array":25,"tonal-midi":35,"tonal-pcset":38,"tonal-transpose":52}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalDictionary=require("tonal-dictionary");var tonalArray=require("tonal-array");var tonalNote=require("tonal-note");var tonalHarmonizer=require("tonal-harmonizer");var DATA=require("./scales.json");var dict=tonalDictionary.dictionary(DATA,function(str){return str.split(" ")});function get(type,tonic){if(arguments.length===1)return function(t){return get(type,t)};var ivls=dict.get(type);return ivls?tonalHarmonizer.harmonize(ivls,tonic):null}var names=dict.keys;function notes(name){var scale=parse(name);var notes=scale.tonic?get(scale.type,tonalNote.pc(scale.tonic)):null;return notes||tonalArray.compact(tonalArray.map(tonalNote.pc,name).map(function(n,i,arr){return arr.indexOf(n)<i?null:n}))}function intervals(name){var scale=parse(name);return get(scale.type,false)||[]}function isKnowScale(name){return intervals(name).length>0}function parse(str){if(typeof str!=="string")return null;var i=str.indexOf(" ");var tonic=tonalNote.note(str.substring(0,i))||false;var type=tonic?str.substring(i+1):str;return{tonic:tonic,type:type}}var detect=tonalDictionary.detector(dict," ");exports.get=get;exports.names=names;exports.notes=notes;exports.intervals=intervals;exports.isKnowScale=isKnowScale;exports.parse=parse;exports.detect=detect},{"./scales.json":50,"tonal-array":25,"tonal-dictionary":28,"tonal-harmonizer":32,"tonal-note":37}],50:[function(require,module,exports){module.exports={chromatic:["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],lydian:["1P 2M 3M 4A 5P 6M 7M"],major:["1P 2M 3M 4P 5P 6M 7M",["ionian"]],mixolydian:["1P 2M 3M 4P 5P 6M 7m",["dominant"]],dorian:["1P 2M 3m 4P 5P 6M 7m"],aeolian:["1P 2M 3m 4P 5P 6m 7m",["minor"]],phrygian:["1P 2m 3m 4P 5P 6m 7m"],locrian:["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],altered:["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],iwato:["1P 2m 4P 5d 7m"],hirajoshi:["1P 2M 3m 5P 6m"],kumoijoshi:["1P 2m 4P 5P 6m"],pelog:["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],prometheus:["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],ritusen:["1P 2M 4P 5P 6M"],scriabin:["1P 2m 3M 5P 6M"],piongio:["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],augmented:["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],neopolitan:["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],diminished:["1P 2M 3m 4P 5d 6m 6M 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],egyptian:["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],oriental:["1P 2m 3M 4P 5d 6M 7m"],spanish:["1P 2m 3M 4P 5P 6m 7m",["phrygian major"]],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],flamenco:["1P 2m 3m 3M 4A 5P 7m"],balinese:["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],persian:["1P 2m 3M 4P 5d 6m 7M"],bebop:["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],enigmatic:["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],ichikosucho:["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}},{}],51:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalInterval=require("tonal-interval");var tonalPitch=require("tonal-pitch");var tonalArray=require("tonal-array");function density(list){var a,b,i;var notes=tonalArray.compact(tonalArray.map(tonalPitch.asNotePitch,list));var len=notes.length;var result=[0,0,0,0,0,0];for(a=0;a<len;a++){for(b=a;b<len;b++){i=tonalInterval.ic(tonalPitch.chr(notes[b])-tonalPitch.chr(notes[a]));if(i===6)result[5]=result[5]+1;else if(i>0)result[5-i]=result[5-i]+1}}return result}exports.density=density},{"tonal-array":25,"tonal-interval":33,"tonal-pitch":45}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tonalPitch=require("tonal-pitch");function trBy(i,p){var t=tonalPitch.pType(p);if(!t)return null;var f=tonalPitch.fifths(i)+tonalPitch.fifths(p);if(tonalPitch.isPC(p))return["tnlp",[f]];var o=tonalPitch.focts(i)+tonalPitch.focts(p);if(t==="note")return["tnlp",[f,o]];var d=tonalPitch.height(i)+tonalPitch.height(p)<0?-1:1;return["tnlp",[d*f,d*o],d]}function transpose(a,b){if(arguments.length===1)return function(b){return transpose(a,b)};var pa=tonalPitch.asPitch(a);var pb=tonalPitch.asPitch(b);var r=tonalPitch.isIvlPitch(pa)?trBy(pa,pb):tonalPitch.isIvlPitch(pb)?trBy(pb,pa):null;return a===pa&&b===pb?r:tonalPitch.strPitch(r)}function trFifths(t,n){if(arguments.length>1)return trFifths(t)(n);return function(n){return transpose(t,tonalPitch.pitch(n,0,1))}}exports.transpose=transpose;exports.trFifths=trFifths},{"tonal-pitch":45}],53:[function(require,module,exports){"use strict";var assign=Object.assign;var tonal={};assign(tonal,require("tonal-array"));assign(tonal,require("tonal-transpose"));assign(tonal,require("tonal-harmonizer"));assign(tonal,require("tonal-distance"));tonal.note=require("tonal-note");tonal.ivl=require("tonal-interval");tonal.midi=require("tonal-midi");tonal.freq=require("tonal-freq");tonal.range=require("tonal-range");tonal.key=require("tonal-key");tonal.scale=function(name){return tonal.scale.notes(name)};assign(tonal.scale,require("tonal-scale"));tonal.chord=function(name){return tonal.chord.notes(name)};assign(tonal.chord,require("tonal-chord"));tonal.pitch=require("tonal-pitch");tonal.notation=require("tonal-notation");tonal.progression=require("tonal-progression");tonal.sonority=require("tonal-sonority");tonal.pitchset=require("tonal-pitchset");tonal.pcset=require("tonal-pcset");if(typeof module==="object"&&module.exports)module.exports=tonal;if(typeof window!=="undefined")window.Tonal=tonal},{"tonal-array":25,"tonal-chord":27,"tonal-distance":29,"tonal-freq":31,"tonal-harmonizer":32,"tonal-interval":33,"tonal-key":34,"tonal-midi":35,"tonal-notation":36,"tonal-note":37,"tonal-pcset":38,"tonal-pitch":45,"tonal-pitchset":46,"tonal-progression":47,"tonal-range":48,"tonal-scale":49,"tonal-sonority":51,"tonal-transpose":52}],54:[function(require,module,exports){var AutoComposerJS=window.AutoComposerJS||{};AutoComposerJS.melody=require("./melody");AutoComposerJS.midiWriter=require("./midi-writer");AutoComposerJS.midiPlayer=require("./midi-player");AutoComposerJS.logic=require("./logic");AutoComposerJS.constants=require("./constants");window.AutoComposerJS=AutoComposerJS;module.exports=AutoComposerJS},{"./constants":56,"./logic":57,"./melody":59,"./midi-player":60,"./midi-writer":61}],55:[function(require,module,exports){class ChordUnit{constructor(chord,chordTones,nextChordUnit){this.chord=chord;this.chordTones=chordTones;this.nextChordUnit=nextChordUnit}setNextChordUnit(next){this.nextChordUnit(next)}}exports.ChordUnit=ChordUnit},{}],56:[function(require,module,exports){var AcConstants={DEFAULT_NOTE_DURATION:"1",DEFAULT_NUM_INSTRUMENTS:3,DEFAULT_LOWER_LIMIT:"Db4",DEFAULT_UPPER_LIMIT:"G#5",ACCOMPANIMENT_LOWER_LIMIT:"Gb2",ACCOMPANIMENT_UPPER_LIMIT:"C#4",BASS_LOWER_LIMIT:"E1",BASS_UPPER_LIMIT:"F2",instrumentData:{melody:{role:"melody",name:"violin",gain:1.7,midiInstrumentCode:40},accompaniment:{role:"accompaniment",name:"acoustic_guitar_steel",gain:1.6,midiInstrumentCode:25},bass:{role:"bass",name:"acoustic_bass",gain:1.65,midiInstrumentCode:32},getByName:function(instrName){for(var instrumentRole in this){if(instrName===this[instrumentRole].name){return this[instrumentRole]}}return null}},NUM_GENERATIONS_LIMIT:1e5,NUM_MELODIES_LIMIT:100};AcConstants.instrumentData["melody"].lowerLimit=AcConstants.DEFAULT_LOWER_LIMIT;AcConstants.instrumentData["melody"].upperLimit=AcConstants.DEFAULT_UPPER_LIMIT;AcConstants.instrumentData["accompaniment"].lowerLimit=AcConstants.ACCOMPANIMENT_LOWER_LIMIT;AcConstants.instrumentData["accompaniment"].upperLimit=AcConstants.ACCOMPANIMENT_UPPER_LIMIT;AcConstants.instrumentData["bass"].lowerLimit=AcConstants.BASS_LOWER_LIMIT;AcConstants.instrumentData["bass"].upperLimit=AcConstants.BASS_UPPER_LIMIT;module.exports=AcConstants},{}],57:[function(require,module,exports){var range=require("tonal-range");var chord=require("tonal-chord");var note=require("tonal-note");class AutoComposerLogic{getChordDictionary(){return chord.names()}filterMelodyRange(melodyString){var totalRange=range.numeric(melodyString);var highest=Math.max.apply(null,totalRange);var lowest=Math.min.apply(null,totalRange);return highest-lowest<=12}filterRepetition(melodyString){var melodyArray=melodyString.split(" ");var isNotRepetitive=true,ctrRepetitions=0;for(var i=0;i<melodyArray.length-1;i++){if(melodyArray[i]===melodyArray[i+1]){ctrRepetitions++}if(ctrRepetitions>=2){isNotRepetitive=false;break}}return isNotRepetitive}isValidText(input){var isChord=chord.isKnownChord(input)?true:false;var isNote=note.name(input)?true:false;return isChord||isNote}convertAsciiAccidentalsToHtml(input){var out=input.replace(/([A-G0-9])b/g,"$1&#9837;");out=out.replace(/([A-G0-9])#/g,"$1&#9839;");out=out.replace(/([A-G0-9])o/g,"$1&deg;");return out}convertAsciiAccidentalsToText(input){var out=input.replace(/([A-G0-9])b/g,"$1");out=out.replace(/([A-G0-9])#/g,"$1");out=out.replace(/([A-G0-9])o/g,"$1");return out}convertAccidentalsToAscii(input){var out=input.replace(/([A-G0-9])/g,"$1b");out=out.replace(/([A-G0-9])/g,"$1#");out=out.replace(/([A-G0-9])/g,"$1o");return out}}module.exports=new AutoComposerLogic},{"tonal-chord":27,"tonal-note":37,"tonal-range":48}],58:[function(require,module,exports){var range=require("tonal-range");class MelodyData{constructor(chordProgression,melodyNotes){this.chordProgression=chordProgression;this.melodyNotes=melodyNotes;this.smoothness=this.getSmoothness();this.range=this.getRange();this.melodyString=this.melodyNotes.join(" ")}getRange(){var totalRange=range.numeric(this.melodyNotes);var highest=Math.max.apply(null,totalRange);var lowest=Math.min.apply(null,totalRange);return highest-lowest}getSmoothness(){var totalSmoothness=0;var subset,subRange,highest,lowest,distance;for(var i=2;i<=this.melodyNotes.length;i++){subset=this.melodyNotes.slice(i-2,i);subRange=range.numeric(subset);highest=Math.max.apply(null,subRange);lowest=Math.min.apply(null,subRange);distance=highest-lowest;totalSmoothness+=distance}return totalSmoothness}}exports.MelodyData=MelodyData},{"tonal-range":48}],59:[function(require,module,exports){var tonal=require("tonal");var ChordUnit=require("./chord-unit");var MelodyData=require("./melody-data");var AcLogic=require("./logic");const AcConstants=require("./constants");class AutoComposerMelody{constructor(){this.lowerLimit=AcConstants.DEFAULT_LOWER_LIMIT;this.upperLimit=AcConstants.DEFAULT_UPPER_LIMIT}_getLowestNoteInRange(pitch,lowerLimit,upperLimit){var chordTonesInRange=tonal.range.pitchSet(pitch,[lowerLimit,upperLimit]);return chordTonesInRange[0]}_removePitchesFromChordTones(chordTones,pitchArray){var indexToRemove;pitchArray.forEach(function(pitch){indexToRemove=chordTones.indexOf(pitch);if(indexToRemove>-1){chordTones.splice(indexToRemove,1)}});return chordTones}buildSimpleAccompaniment(melodyUnit){var noteArray=[],chordNotes,currentChord,bassPitch,topPitch;for(var i=0;i<melodyUnit.chordProgression.length;i++){currentChord=melodyUnit.chordProgression[i];bassPitch=tonal.chord.parse(currentChord)["tonic"];topPitch=tonal.note.pc(melodyUnit.melodyNotes[i]);chordNotes=tonal.chord.notes(currentChord);chordNotes=this._removePitchesFromChordTones(chordNotes,[topPitch]);for(var j=0;j<chordNotes.length;j++){chordNotes[j]=this._getLowestNoteInRange(chordNotes[j],AcConstants.ACCOMPANIMENT_LOWER_LIMIT,AcConstants.ACCOMPANIMENT_UPPER_LIMIT)}noteArray.push(chordNotes.join(" "))}return noteArray}buildBasicBassLine(melodyUnit){var noteArray=[],currentChord,bassPitch,bassNote;for(var i=0;i<melodyUnit.chordProgression.length;i++){currentChord=melodyUnit.chordProgression[i];bassPitch=tonal.chord.parse(currentChord)["tonic"];bassNote=this._getLowestNoteInRange(bassPitch,AcConstants.BASS_LOWER_LIMIT,AcConstants.BASS_UPPER_LIMIT);noteArray.push(bassNote)}return noteArray}_getAllChordTones(chord,lowerLimit,upperLimit){var chordTones=tonal.chord(chord);var chordTonesInRange=tonal.range.pitchSet(chordTones,[lowerLimit,upperLimit]);for(var i=0;i<chordTonesInRange.length;i++){for(var j=0;j<chordTones.length;j++){if(tonal.note.pc(chordTonesInRange[i])!=chordTones[j]&&tonal.note.enharmonics(chordTones[j]).indexOf(tonal.note.pc(chordTonesInRange[i]))>-1){chordTonesInRange[i]=chordTones[j]+tonal.note.oct(chordTonesInRange[i])}}}return chordTonesInRange}_buildChordUnit(chord,lowerLimit,upperLimit){var chordTonesInRange=this._getAllChordTones(chord,lowerLimit,upperLimit);var chordUnit=new ChordUnit.ChordUnit(chord,chordTonesInRange,null);return chordUnit}_buildMelodyData(chordProgression,melodyString){var arrMelody=melodyString.split(" ");var melodyUnit=new MelodyData.MelodyData(chordProgression,arrMelody);return melodyUnit}_buildMelodyDataList(chordProgression,rawMelodies,options){var melodyUnits=[];var haxThis=this;rawMelodies.forEach(function(rawMelody){melodyUnits.push(haxThis._buildMelodyData(chordProgression,rawMelody))});if(options){if(options.sort){melodyUnits.sort(function(a,b){return a.smoothness-b.smoothness})}if(options.limit){melodyUnits.splice(options.limit)}}return melodyUnits}_buildChordUnitList(chordProgression,lowerLimit,upperLimit){if(lowerLimit==null){lowerLimit=this.lowerLimit}if(upperLimit==null){upperLimit=this.upperLimit}var chordUnitList=[];var chordTonesInRange;for(var i=chordProgression.length-1;i>=0;i--){chordTonesInRange=this._getAllChordTones(chordProgression[i],lowerLimit,upperLimit);if(i===chordProgression.length){chordUnitList[i]=new ChordUnit.ChordUnit(chordProgression[i],chordTonesInRange,null)}else{chordUnitList[i]=new ChordUnit.ChordUnit(chordProgression[i],chordTonesInRange,chordUnitList[i+1])}}return chordUnitList}_buildSimpleMelodiesCore(chordUnit,melodyList,options){var returnList=[];var chordTones=chordUnit.chordTones;var currentMelody,currentChordTone;var rawMelody,newMelody,isInRange;var isNotRepetitive,timestamp,haxThis=this;if(melodyList){for(var i=0;i<melodyList.length;i++){currentMelody=melodyList[i];for(var j=0;j<chordTones.length;j++){currentChordTone=chordTones[j];if(melodyList.length>1e4){timestamp=(new Date).valueOf().toString().slice(-8);if(timestamp%8===0){break}}newMelody=currentMelody+" "+currentChordTone;if(options.filtered){isInRange=AcLogic.filterMelodyRange(newMelody);if(!isInRange){break}if(newMelody.split(" ").length>=3){isNotRepetitive=AcLogic.filterRepetition(newMelody)}else{isNotRepetitive=true}if(!isNotRepetitive){break}returnList.push(newMelody)}else{returnList.push(newMelody)}}}}else{melodyList=chordUnit.chordTones;returnList.push.apply(returnList,melodyList)}if(chordUnit.nextChordUnit){return this._buildSimpleMelodiesCore(chordUnit.nextChordUnit,returnList,options)}else{if(options.filtered&&returnList.length>AcConstants.NUM_MELODIES_LIMIT){console.log("Generated  "+returnList.length+" melodies. Creating list of "+AcConstants.NUM_MELODIES_LIMIT+"...")}else{console.log("Generated  "+returnList.length+" melodies.")}return returnList}}buildAllMelodies(chordProgression){var chordUnitList=this._buildChordUnitList(chordProgression,this.lowerLimit,this.upperLimit);var melodies=this._buildSimpleMelodiesCore(chordUnitList[0],null,{filtered:false});var melodyUnits=[];var haxThis=this;melodies.forEach(function(rawMelody){melodyUnits.push(haxThis._buildMelodyData(chordProgression,rawMelody))});return melodyUnits}buildRawMelodies(chordProgression){var chordUnitList=this._buildChordUnitList(chordProgression,this.lowerLimit,this.upperLimit);var melodies=this._buildSimpleMelodiesCore(chordUnitList[0],null,{filtered:true});return melodies}buildSimpleMelodies(chordProgression,options){var useDefault,melodyUnits,rawMelodies,coreOptions,muOptions;var rawOption,limitOption,filterOption,sortOption;var chordUnitList=this._buildChordUnitList(chordProgression,this.lowerLimit,this.upperLimit);if(options){rawOption=options.raw&&(options.raw==="true"||options.raw===true)?true:false;filterOption=typeof options.filter!=="undefined"&&(options.filter==="false"||options.limit===false)?false:true;if(typeof options.filter!=="undefined"&&(options.limit==="false"||options.limit===false)){limitOption=null;sortOption=false}else{limitOption=AcConstants.NUM_MELODIES_LIMIT;sortOption=true}}else{rawOption=false;filterOption=true;limitOption=AcConstants.NUM_MELODIES_LIMIT;sortOption=true}rawMelodies=this._buildSimpleMelodiesCore(chordUnitList[0],null,{filtered:filterOption});if(rawOption){return rawMelodies}melodyUnits=this._buildMelodyDataList(chordProgression,rawMelodies,{sort:sortOption,limit:limitOption});return melodyUnits}}module.exports=new AutoComposerMelody},{"./chord-unit":55,"./constants":56,"./logic":57,"./melody-data":58,tonal:53}],60:[function(require,module,exports){const MidiPlayer=require("midi-player-js");const SoundfontPlayer=require("soundfont-player");const tonalNote=require("tonal-note");const AcMidiWriter=require("./midi-writer");const AcConstants=require("./constants");const INSTRUMENT_DATA=AcConstants.instrumentData;class AutoComposerMidiPlayer{constructor(){this.instruments={};this.numInstrumentsInit=0;this.player=null;this.audioContext=new AudioContext;this.initialized=false;this.playbackLocked=true;var haxThis=this;var currentInstrument,sfOptions,numLowerLimit=0,numUpperLimit=0,instrNotes;for(var instrumentRole in INSTRUMENT_DATA){if(typeof INSTRUMENT_DATA[instrumentRole]!=="function"){instrNotes=[];numLowerLimit=tonalNote.midi(INSTRUMENT_DATA[instrumentRole].lowerLimit);numUpperLimit=tonalNote.midi(INSTRUMENT_DATA[instrumentRole].upperLimit);for(var midiCode=numLowerLimit;midiCode<=numUpperLimit;midiCode++){instrNotes.push(midiCode)}sfOptions={soundfont:"FluidR3_GM"};Soundfont.instrument(this.audioContext,INSTRUMENT_DATA[instrumentRole].name,sfOptions).then(function(sfInstrument){currentInstrument=INSTRUMENT_DATA.getByName(sfInstrument.name);haxThis.instruments[currentInstrument.role]=sfInstrument;haxThis.numInstrumentsInit++;console.log("Instrument loaded!");if(haxThis.numInstrumentsInit===AcConstants.DEFAULT_NUM_INSTRUMENTS){haxThis._finishLoad()}})}}}_midiCallback(event){var instr1=this.instruments["melody"];var instr2=this.instruments["accompaniment"];var instr3=this.instruments["bass"];if(!this.playbackLocked&&event.name=="Note on"&&event.velocity>0){switch(event.track){case 1:instr1.play(event.noteName,this.audioContext.currentTime,{gain:instr1.gain});break;case 2:instr2.play(event.noteName,this.audioContext.currentTime,{gain:instr2.gain});break;case 3:instr3.play(event.noteName,this.audioContext.currentTime,{gain:instr3.gain});break;default:}}if(event.name=="Note off"){switch(event.track){case 1:instr1.stop();break;case 2:instr2.stop();break;case 3:instr3.stop();break;default:}}if(event.name=="End of Track"){this.playbackLocked=true}}_finishLoad(){var haxThis=this;this.player=new MidiPlayer.Player(function(event){haxThis._midiCallback(event)});this.initialized=true;this.playbackLocked=false;var updateEvent=new CustomEvent("statusUpdate",{detail:"MIDI player is loaded!"});document.body.dispatchEvent(updateEvent)}playMelodySolo(melodySolo){var strMidi=AcMidiWriter.buildMelodyMidi(melodySolo);this._playMelody(strMidi)}playMelodyWithAccompaniment(melodySolo,melodyAccomp,melodyBass){var strMidi=AcMidiWriter.buildMelodyMidiWithAccompaniment(melodySolo,melodyAccomp,melodyBass);this._playMelody(strMidi)}_playMelody(strMidi){if(this.initialized){this.stopPlayback();this.playbackLocked=false;this.player.loadDataUri(strMidi);this.player.play()}else{console.warn("[AutoComposerMidi._playMelody()] Player isn't initialized yet...")}}stopPlayback(){this.instruments["melody"].stop();this.instruments["accompaniment"].stop();this.instruments["bass"].stop();this.player.stop()}}module.exports=new AutoComposerMidiPlayer},{"./constants":56,"./midi-writer":61,"midi-player-js":11,"soundfont-player":23,"tonal-note":37}],61:[function(require,module,exports){var MidiWriter=require("midi-writer-js");var MidiPlayer=require("midi-player-js");var SoundfontPlayer=require("soundfont-player");var tonalNote=require("tonal-note");const AcConstants=require("./constants");const INSTRUMENT_DATA=AcConstants.instrumentData;class AutoComposerMidiWriter{constructor(){}_buildMidi(arrNumMidi,duration,wait){if(!wait){wait="0"}return new MidiWriter.NoteEvent({pitch:arrNumMidi,duration:duration,wait:wait,velocity:100})}_buildTrack(arrChordNotes,instrData){var notes,midiNumber,midiNumbers;var returnTrack=new MidiWriter.Track;returnTrack.addEvent(new MidiWriter.ProgramChangeEvent({instrument:instrData.midiInstrumentCode}));returnTrack.addInstrumentName(instrData.name);for(var i=0;i<arrChordNotes.length;i++){midiNumbers=[];notes=arrChordNotes[i].split(" ");notes.forEach(function(note){midiNumbers.push(tonalNote.midi(note))});returnTrack.addEvent(this._buildMidi(midiNumbers,AcConstants.DEFAULT_NOTE_DURATION))}return returnTrack}buildMelodyMidi(arrMelody){var tracks=[],midiNumber;tracks[0]=this._buildTrack(arrMelody,INSTRUMENT_DATA["melody"]);var write=new MidiWriter.Writer(tracks);return write.dataUri()}buildMelodyMidiWithAccompaniment(arrMelody,arrAcompanimentLine,arrBassLine){var tracks,midiNumber;var melodyTrack=this._buildTrack(arrMelody,INSTRUMENT_DATA["melody"]);var accompanimentTrack=this._buildTrack(arrAcompanimentLine,INSTRUMENT_DATA["accompaniment"]);var bassTrack=this._buildTrack(arrBassLine,INSTRUMENT_DATA["bass"]);tracks=[melodyTrack,accompanimentTrack,bassTrack];var write=new MidiWriter.Writer(tracks);return write.dataUri()}}module.exports=new AutoComposerMidiWriter},{"./constants":56,"midi-player-js":11,"midi-writer-js":12,"soundfont-player":23,"tonal-note":37}]},{},[54]);